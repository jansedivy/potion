!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):"object"==typeof exports?exports.Potion=e():t.Potion=e()}(this,function(){return function(t){function e(n){if(i[n])return i[n].exports;var o=i[n]={exports:{},id:n,loaded:!1};return t[n].call(o.exports,o,o.exports,e),o.loaded=!0,o.exports}var i={};return e.m=t,e.c=i,e.p="",e(0)}([function(t,e,i){"use strict";var n=i(1);t.exports={init:function(t,e){var i=new n(t,e);return i.game}}},function(t,e,i){"use strict";i(2)();var n=i(3),o=i(4),s=i(5),r=i(7),a=i(6),u=function(t,e){var i=this._subclassGame(t,e);t.style.position="relative";var n=document.createElement("canvas");n.style.display="block",t.appendChild(n),this.game=new i(n),this.game.debug=new r(this.game),this._setDefaultStates(),this.game.config.addInputEvents&&(this.game.input=new o(this.game,t)),this.tickFunc=function(t){return function(){t.tick()}}(this),this.preloaderTickFunc=function(t){return function(){t._preloaderTick()}}(this),this.strayTime=0,this._time=s.now(),this.game.assets.onload(function(){this.start(),window.cancelAnimationFrame(this.preloaderId),window.requestAnimationFrame(this.tickFunc)}.bind(this)),this.game.assets.isLoading&&(this.preloaderId=window.requestAnimationFrame(this.preloaderTickFunc))};u.prototype.addEvents=function(){var t=this;t.game,window.addEventListener("blur",function(){t.game.input.resetKeys(),t.game.blur()}),window.addEventListener("focus",function(){t.game.input.resetKeys(),t.game.focus()})},u.prototype.start=function(){this.game.config.addInputEvents&&this.addEvents()},u.prototype.tick=function(){window.requestAnimationFrame(this.tickFunc);var t=s.now(),e=(t-this._time)/1e3;this._time=t,this.update(e),this.game.states.exitUpdate(e),this.render()},u.prototype.update=function(t){if(t>this.game.config.maxStepTime&&(t=this.game.config.maxStepTime),this.game.config.fixedStep)for(this.strayTime=this.strayTime+t;this.strayTime>=this.game.config.stepTime;)this.strayTime=this.strayTime-this.game.config.stepTime,this.game.states.update(this.game.config.stepTime);else this.game.states.update(t)},u.prototype.render=function(){this.game.video.beginFrame(),this.game.video.clear(),this.game.states.render(),this.game.video.endFrame()},u.prototype._preloaderTick=function(){this.preloaderId=window.requestAnimationFrame(this.preloaderTickFunc);var t=s.now(),e=(t-this._time)/1e3;this._time=t,this.game.config.showPreloader&&(this.game.video.clear(),this.game.preloading(e))},u.prototype._setDefaultStates=function(){var t=new a;t.add("app",this.game),t.add("debug",this.game.debug),t.protect("app"),t.protect("debug"),this.game.states=t},u.prototype._subclassGame=function(t,e){var i=function(t){n.call(this,t)};i.prototype=Object.create(n.prototype);for(var o in e)i.prototype[o]=e[o];return i},t.exports=u},function(t,e,i){"use strict";t.exports=function(){for(var t=0,e=["ms","moz","webkit","o"],i=0;i<e.length&&!window.requestAnimationFrame;++i)window.requestAnimationFrame=window[e[i]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[e[i]+"CancelAnimationFrame"]||window[e[i]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(e){var i=(new Date).getTime(),n=Math.max(0,16-(i-t)),o=window.setTimeout(function(){e(i+n)},n);return t=i+n,o}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)})}},function(t,e,i){"use strict";var n=i(8),o=i(9),s=function(t){this.canvas=t,this.width=300,this.height=300,this.assets=new o,this.states=null,this.debug=null,this.config={useRetina:!0,initializeCanvas:!0,initializeVideo:!0,addInputEvents:!0,showPreloader:!0,fixedStep:!1,stepTime:.01666,maxStepTime:.01666},this.configure(),this.input=null,this.config.initializeVideo&&(this.video=new n(this,t,this.config))};s.prototype.init=function(){},s.prototype.configure=function(){},s.prototype.render=function(){},s.prototype.update=function(t){},s.prototype.exitUpdate=function(t){},s.prototype.setSize=function(t,e){this.width=t,this.height=e,this.video&&this.video.setSize(t,e),this.states&&this.states.resize()},s.prototype.preloading=function(t){if((this.config.showPreloader||this.video&&this.video.ctx)&&this.video.ctx){void 0===this._preloaderWidth&&(this._preloaderWidth=0);var e=Math.min(2*this.width/3,300),i=20,n=(this.height-i)/2,o=(this.width-e)/2,s=e*this.assets.progress;this._preloaderWidth=this._preloaderWidth+(s-this._preloaderWidth)*t*10,this.video.ctx.save(),this.video.ctx.fillStyle="#a9c848",this.video.ctx.fillRect(0,0,this.width,this.height),this.video.ctx.fillStyle="#f6ffda",this.video.ctx.font="300 40px sans-serif",this.video.ctx.textAlign="center",this.video.ctx.textBaseline="bottom",this.video.ctx.fillText("Potion.js",this.width/2,n),this.video.ctx.fillStyle="#88a237",this.video.ctx.fillRect(o,n+15,e,i),this.video.ctx.fillStyle="#f6ffda",this.video.ctx.fillRect(o,n+15,this._preloaderWidth,i),this.video.ctx.strokeStyle="#f6ffda",this.video.ctx.lineWidth=2,this.video.ctx.beginPath(),this.video.ctx.rect(o-5,n+10,this._preloaderWidth+10,i+10),this.video.ctx.closePath(),this.video.ctx.stroke(),this.video.ctx.restore()}},s.prototype.focus=function(){},s.prototype.blur=function(){},s.prototype.click=function(){},s.prototype.mousemove=function(t,e){},s.prototype.mousedown=function(){},s.prototype.mouseup=function(){},s.prototype.keydown=function(){},s.prototype.keyup=function(){},s.prototype.resize=function(){},t.exports=s},function(t,e,i){"use strict";var n=i(10),o=function(t,e){this._container=e,this.keys={},this.canControlKeys=!0,this.mouse={isDown:!1,button:null,x:null,y:null},this._addEvents(t)};o.prototype.resetKeys=function(){this.keys={}},o.prototype.isKeyDown=function(t){if(null==t)return!1;if(this.canControlKeys){var e="number"==typeof t?t:n[t.toUpperCase()];return this.keys[e]}},o.prototype._addEvents=function(t){var e=this;e._container.addEventListener("mousemove",function(i){var n=void 0===i.offsetX?i.layerX-e._container.offsetLeft:i.offsetX,o=void 0===i.offsetY?i.layerY-e._container.offsetTop:i.offsetY;t.states.mousemove(n,o,i),e.mouse.x=n,e.mouse.y=o}),e._container.addEventListener("click",function(i){i.preventDefault();var n=void 0===i.offsetX?i.layerX-e._container.offsetLeft:i.offsetX,o=void 0===i.offsetY?i.layerY-e._container.offsetTop:i.offsetY;t.states.click(n,o,i.button)}),e._container.addEventListener("mouseup",function(i){i.preventDefault();var n=void 0===i.offsetX?i.layerX-e._container.offsetLeft:i.offsetX,o=void 0===i.offsetY?i.layerY-e._container.offsetTop:i.offsetY;switch(e.mouse.button=i.button,e.mouse.isDown=!1,i.button){case 0:e.mouse.isLeftDown=!1;break;case 1:e.mouse.isMiddleDown=!1;break;case 2:e.mouse.isRightDown=!1}t.states.mouseup(n,o,i.button)},!1),e._container.addEventListener("mousedown",function(i){i.preventDefault();var n=void 0===i.offsetX?i.layerX-e._container.offsetLeft:i.offsetX,o=void 0===i.offsetY?i.layerY-e._container.offsetTop:i.offsetY;switch(e.mouse.x=n,e.mouse.y=o,e.mouse.button=i.button,e.mouse.isDown=!0,i.button){case 0:e.mouse.isLeftDown=!0;break;case 1:e.mouse.isMiddleDown=!0;break;case 2:e.mouse.isRightDown=!0}t.states.mousedown(n,o,i.button)},!1);var i=null,n=null;e._container.addEventListener("touchstart",function(o){var s=o.layerX,r=o.layerY;i=s,n=r,e.mouse.x=s,e.mouse.y=r,e.mouse.isDown=!0,t.states.mousedown(s,r,o)}),e._container.addEventListener("touchmove",function(i){i.preventDefault();var n=i.layerX,o=i.layerY;t.states.mousemove(n,o,i),e.mouse.x=n,e.mouse.y=o}),e._container.addEventListener("touchend",function(o){o.preventDefault(),e.mouse.isDown=!1;for(var s=0,r=o.changedTouches.length;r>s;s++){var a=o.changedTouches[s],u=a.pageX-e._container.offsetLeft,c=a.pageY-e._container.offsetTop,h=0,p=Math.abs(i-u),d=Math.abs(n-c),f=5;f>p&&f>d&&(e.mouse.x=u,e.mouse.y=c,t.states.click(u,c,h))}}),e._container.addEventListener("contextmenu",function(t){t.preventDefault()}),document.addEventListener("keydown",function(e){t.input.keys[e.keyCode]=!0,t.states.keydown(e.which,e)}),document.addEventListener("keyup",function(e){t.input.keys[e.keyCode]=!1,t.states.keyup(e.which,e)}),document.addEventListener("keypress",function(e){t.states.keypress(e.which,e)})},t.exports=o},function(t,e,i){"use strict";t.exports=function(){return window.performance||Date}()},function(t,e,i){"use strict";var n=function(t,e){return t.renderOrder<e.renderOrder},o=function(t,e){return t.updateOrder<e.updateOrder},s=function(){this.states={},this.renderOrder=[],this.updateOrder=[]};s.prototype.add=function(t,e){return this.states[t]=this._newStateHolder(t,e),this.refreshOrder(),e},s.prototype.enable=function(t){var e=this.get(t);e&&(e.enabled||(e.state.enable&&e.state.enable(),e.enabled=!0,e.paused&&this.unpause(t)))},s.prototype.disable=function(t){var e=this.get(t);e&&e.enabled&&(e.state.disable&&e.state.disable(),e.enabled=!1)},s.prototype.pause=function(t){var e=this.get(t);e&&(e.state.pause&&e.state.pause(),e.paused=!0)},s.prototype.unpause=function(t){var e=this.get(t);e&&(e.state.unpause&&e.state.unpause(),e.paused=!1)},s.prototype.protect=function(t){var e=this.get(t);e&&(e.protect=!0)},s.prototype.unprotect=function(t){var e=this.get(t);e&&(e.protect=!1)},s.prototype.refreshOrder=function(){this.renderOrder.length=0,this.updateOrder.length=0;for(var t in this.states){var e=this.states[t];e&&(this.renderOrder.push(e),this.updateOrder.push(e))}this.renderOrder.sort(n),this.updateOrder.sort(o)},s.prototype._newStateHolder=function(t,e){var i={};return i.name=t,i.state=e,i.protect=!1,i.enabled=!0,i.paused=!1,i.render=!0,i.initialized=!1,i.updated=!1,i.updateOrder=0,i.renderOrder=0,i},s.prototype.setUpdateOrder=function(t,e){var i=this.get(t);i&&(i.updateOrder=e,this.refreshOrder())},s.prototype.setRenderOrder=function(t,e){var i=this.get(t);i&&(i.renderOrder=e,this.refreshOrder())},s.prototype.destroy=function(t){var e=this.get(t);e&&!e.protect&&(e.state.close&&e.state.close(),delete this.states[t],this.refreshOrder())},s.prototype.destroyAll=function(){for(var t=0,e=this.updateOrder.length;e>t;t++){var i=this.updateOrder[t];i.protect||(i.state.close&&i.state.close(),delete this.states[i.name])}this.refreshOrder()},s.prototype.get=function(t){return this.states[t]},s.prototype.update=function(t){for(var e=0,i=this.updateOrder.length;i>e;e++){var n=this.updateOrder[e];n&&n.enabled&&n.state.update&&!n.paused&&(!n.initialized&&n.state.init&&(n.initialized=!0,n.state.init()),n.state.update(t),n.updated=!0)}},s.prototype.exitUpdate=function(t){for(var e=0,i=this.updateOrder.length;i>e;e++){var n=this.updateOrder[e];n.enabled&&n.state.exitUpdate&&!n.paused&&n.state.exitUpdate(t)}},s.prototype.render=function(){for(var t=0,e=this.renderOrder.length;e>t;t++){var i=this.renderOrder[t];i.enabled&&(i.updated||!i.state.update)&&i.render&&i.state.render&&i.state.render()}},s.prototype.mousemove=function(t,e,i){for(var n=0,o=this.updateOrder.length;o>n;n++){var s=this.updateOrder[n];s.enabled&&s.state.mousemove&&!s.paused&&s.state.mousemove(t,e,i)}},s.prototype.mouseup=function(t,e,i){for(var n=0,o=this.updateOrder.length;o>n;n++){var s=this.updateOrder[n];s.enabled&&s.state.mouseup&&!s.paused&&s.state.mouseup(t,e,i)}},s.prototype.mousedown=function(t,e,i){for(var n=0,o=this.updateOrder.length;o>n;n++){var s=this.updateOrder[n];s.enabled&&s.state.mousedown&&!s.paused&&s.state.mousedown(t,e,i)}},s.prototype.click=function(t,e,i){for(var n=0,o=this.updateOrder.length;o>n;n++){var s=this.updateOrder[n];s.enabled&&s.state.click&&!s.paused&&s.state.click(t,e,i)}},s.prototype.keypress=function(t){for(var e=0,i=this.updateOrder.length;i>e;e++){var n=this.updateOrder[e];n.enabled&&n.state.keypress&&!n.paused&&n.state.keypress(t)}},s.prototype.keyup=function(t){for(var e=0,i=this.updateOrder.length;i>e;e++){var n=this.updateOrder[e];n.enabled&&n.state.keyup&&!n.paused&&n.state.keyup(t)}},s.prototype.keydown=function(t){for(var e=0,i=this.updateOrder.length;i>e;e++){var n=this.updateOrder[e];n.enabled&&n.state.keydown&&!n.paused&&n.state.keydown(t)}},s.prototype.resize=function(){for(var t=0,e=this.updateOrder.length;e>t;t++){var i=this.updateOrder[t];i.enabled&&i.render&&i.state.resize&&i.state.resize()}},t.exports=s},function(t,e,i){"use strict";var n=i(12),o=i(11),s=[],r=function(){var t=s.pop();return t?t:{}},a=function(t){return 9>=t?48+t:10===t?48:t>10&&36>=t?64+(t-10):null},u=[{name:"Show FPS",entry:"showFps","default":!0},{name:"Show Key Codes",entry:"showKeyCodes","default":!0},{name:"Show Time",entry:"showTime","default":!0}],c=function(t){this.video=t.video.createLayer({useRetina:!0,initializeCanvas:!0}),this.app=t,this.options=u,this._maxLogsCounts=10;for(var e=0;e<this.options.length;e++){var i=this.options[e];this._initOption(i)}this.disabled=!1,this.fps=0,this.fpsCount=0,this.fpsElapsedTime=0,this.fpsUpdateInterval=.5,this._fontSize=0,this._dirtyManager=new o(this.video.canvas,this.video.ctx),this.logs=[],this.showDebug=!1,this.enableDebugKeys=!0,this.enableShortcuts=!1,this.enableShortcutsKey=220,this.lastKey=null,this._load(),this.keyShortcuts=[{key:123,entry:"showDebug",type:"toggle"}]};c.prototype._setFont=function(t,e){this._fontSize=t,this.video.ctx.font=t+"px "+e},c.prototype.resize=function(){this.video.setSize(this.app.width,this.app.height)},c.prototype.addConfig=function(t){this.options.push(t),this._initOption(t)},c.prototype._initOption=function(t){t.type=t.type||"toggle",t["default"]=null==t["default"]?!1:t["default"],"toggle"===t.type&&(this[t.entry]=t["default"])},c.prototype.clear=function(){this.logs.length=0},c.prototype.log=function(t,e){e=e||"white",t="string"==typeof t?t:n.inspect(t);for(var i=t.replace(/\\'/g,"'").split("\n"),o=0;o<i.length;o++){var a=i[o];this.logs.length>=this._maxLogsCounts&&s.push(this.logs.shift());var u=r();u.text=a,u.life=10,u.color=e,this.logs.push(u)}},c.prototype.update=function(){},c.prototype.exitUpdate=function(t){if(!this.disabled&&this.showDebug){if(this._maxLogsCounts=Math.ceil((this.app.height+20)/20),this.fpsCount+=1,this.fpsElapsedTime+=t,this.fpsElapsedTime>this.fpsUpdateInterval){var e=this.fpsCount/this.fpsElapsedTime;this.showFps&&(this.fps=this.fps*(1-.8)+.8*e),this.fpsCount=0,this.fpsElapsedTime=0}for(var i=0,n=this.logs.length;n>i;i++){var o=this.logs[i];if(o&&(o.life-=t,o.life<=0)){var s=this.logs.indexOf(o);s>-1&&this.logs.splice(s,1)}}}},c.prototype.keydown=function(t){if(!this.disabled){this.lastKey=t;var e;if(this.enableDebugKeys){if(t===this.enableShortcutsKey)return this.enableShortcuts=!this.enableShortcuts,!0;if(this.enableShortcuts)for(e=0;e<this.options.length;e++){var i=this.options[e],n=e+1;this.app.input.isKeyDown("ctrl")&&(n-=36);var o=a(n);if(o&&t===o)return"toggle"===i.type?(this[i.entry]=!this[i.entry],this._save()):"call"===i.type&&i.entry(),!0}}for(e=0;e<this.keyShortcuts.length;e++){var s=this.keyShortcuts[e];if(s.key===t)return"toggle"===s.type?(this[s.entry]=!this[s.entry],this._save()):"call"===s.type&&this[s.entry](),!0}return!1}},c.prototype._save=function(){for(var t={showDebug:this.showDebug,options:{}},e=0;e<this.options.length;e++){var i=this.options[e],n=this[i.entry];t.options[i.entry]=n}window.localStorage.__potionDebug=JSON.stringify(t)},c.prototype._load=function(){if(window.localStorage&&window.localStorage.__potionDebug){var t=JSON.parse(window.localStorage.__potionDebug);this.showDebug=t.showDebug;for(var e in t.options)this[e]=t.options[e]}},c.prototype.render=function(){this.disabled||(this._dirtyManager.clear(),this.showDebug&&(this.video.ctx.save(),this._setFont(15,"sans-serif"),this._renderLogs(),this._renderData(),this._renderShortcuts(),this.video.ctx.restore()))},c.prototype._renderLogs=function(){this.video.ctx.textAlign="left",this.video.ctx.textBaseline="bottom";for(var t=0,e=this.logs.length;e>t;t++){var i=this.logs[t],n=-10+this.app.height+20*(t-this.logs.length+1);this._renderText(i.text,10,n,i.color)}},c.prototype.disable=function(){this.disabled=!0},c.prototype._renderData=function(){this.video.ctx.textAlign="right",this.video.ctx.textBaseline="top";var t=this.app.width-14,e=14;this.showFps&&this._renderText(Math.round(this.fps)+" fps",t,e),e+=20,this._setFont(15,"sans-serif"),this.showKeyCodes&&(this._renderText("key "+this.lastKey,t,e,this.app.input.isKeyDown(this.lastKey)?"#e9dc7c":"white"),this._renderText("btn "+this.app.input.mouse.button,t-60,e,this.app.input.mouse.isDown?"#e9dc7c":"white"))},c.prototype._renderShortcuts=function(){if(this.enableShortcuts){var t=28;this._setFont(20,"Helvetica Neue, sans-serif"),this.video.ctx.textAlign="left",this.video.ctx.textBaseline="top";for(var e=Math.floor((this.app.height-14)/t),i=0;i<this.options.length;i++){var n=this.options[i],o=14+320*Math.floor(i/e),s=14+i%e*t,r=i+1,u=a(r),c=this[n.entry],h=String.fromCharCode(u);u||(h="^+"+String.fromCharCode(a(r-36)));var p="["+h+"] "+n.name;"toggle"===n.type?p+=" ("+(c?"ON":"OFF")+")":"call"===n.type&&(p+=" (CALL)");var d="rgba(255, 255, 255, 1)",f="rgba(0, 0, 0, 1)";c||(d="rgba(255, 255, 255, .7)",f="rgba(0, 0, 0, .7)"),this._renderText(p,o,s,d,f)}}},c.prototype._renderText=function(t,e,i,n,o){n=n||"white",o=o||"black",this.video.ctx.fillStyle=n,this.video.ctx.lineJoin="round",this.video.ctx.strokeStyle=o,this.video.ctx.lineWidth=3,this.video.ctx.strokeText(t,e,i),this.video.ctx.fillText(t,e,i);var s=this.video.ctx.measureText(t).width,r=e-5,a=i,u=s+10,c=this._fontSize+10;"right"===this.video.ctx.textAlign&&(r=e-5-s),this._dirtyManager.addRect(r,a,u,c)},t.exports=c},function(t,e,i){"use strict";var n=i(13)(),o=function(t,e,i){this.game=t,this.config=i,this.canvas=e,this.width=t.width,this.height=t.height,i.initializeCanvas&&(this.ctx=e.getContext("2d")),this._applySizeToCanvas()};o.prototype.include=function(t){for(var e in t)this[e]=t[e]},o.prototype.beginFrame=function(){},o.prototype.endFrame=function(){},o.prototype.scaleCanvas=function(t){this.canvas.style.width=this.canvas.width+"px",this.canvas.style.height=this.canvas.height+"px",this.canvas.width*=t,this.canvas.height*=t,this.ctx&&this.ctx.scale(t,t)},o.prototype.setSize=function(t,e){this.width=t,this.height=e,this._applySizeToCanvas()},o.prototype._applySizeToCanvas=function(){this.canvas.width=this.width,this.canvas.height=this.height;var t=this.canvas.parentElement;t.style.width=this.width+"px",t.style.height=this.height+"px",this.config.useRetina&&n&&this.scaleCanvas(2)},o.prototype.clear=function(){this.ctx&&this.ctx.clearRect(0,0,this.width,this.height)},o.prototype.createLayer=function(t){t=t||{};var e=this.canvas.parentElement,i=document.createElement("canvas");i.width=this.width,i.height=this.height,i.style.position="absolute",i.style.top="0px",i.style.left="0px",e.appendChild(i);var n=new o(this.game,i,t);return n},t.exports=o},function(t,e,i){(function(e){"use strict";var n=i(14),o=i(15),s=function(){this.isLoading=!1,this.itemsCount=0,this.loadedItemsCount=0,this.progress=0,this._xhr=new XMLHttpRequest,this._thingsToLoad=0,this._data={},this.callback=null,this._toLoad=[],this.audio=new o};s.prototype.onload=function(t){this.callback=t,0===this._thingsToLoad?(this.isLoading=!1,e.nextTick(function(){t()})):this._nextFile()},s.prototype.get=function(t){return this._data[t]},s.prototype.set=function(t,e){this._data[t]=e},s.prototype.load=function(t,e,i){this.isLoading=!0,this.itemsCount+=1,this._thingsToLoad+=1,this._toLoad.push({type:t,url:e,callback:i})},s.prototype._finishedOneFile=function(){if(this._nextFile(),this.progress=this.loadedItemsCount/this.itemsCount,this._thingsToLoad-=1,this.loadedItemsCount+=1,0===this._thingsToLoad){var t=this;setTimeout(function(){t.callback(),t.isLoading=!1},0)}},s.prototype._error=function(t,e){console.warn('Error loading "'+t+'" asset with url '+e),this._nextFile()},s.prototype._save=function(t,e,i){this.set(t,e),i&&i(e),this._finishedOneFile()},s.prototype._handleCustomLoading=function(t){var e=this,i=function(t,i){e._save(t,i)};t(i)},s.prototype._nextFile=function(){var t=this._toLoad.shift();if(t){var e=t.type,i=t.url,o=t.callback,s=this;if(n.isFunction(e))return void this._handleCustomLoading(e);e=e.toLowerCase();var r=this._xhr;switch(e){case"json":r.open("GET",i,!0),r.responseType="text",r.onload=function(){var t=JSON.parse(this.response);s._save(i,t,o)},r.onerror=function(){s._error(e,i)},r.send();break;case"mp3":case"music":case"sound":s.audio.load(i,function(t){s._save(i,t,o)});break;case"image":case"texture":case"sprite":var a=new Image;a.onload=function(){s._save(i,a,o)},a.onerror=function(){s._error(e,i)},a.src=i;break;default:r.open("GET",i,!0),r.responseType="text",r.onload=function(){var t=this.response;s._save(i,t,o)},r.onerror=function(){s._error(e,i)},r.send()}}},t.exports=s}).call(e,i(16))},function(t,e,i){"use strict";t.exports={MOUSE1:-1,MOUSE2:-3,MWHEEL_UP:-4,MWHEEL_DOWN:-5,BACKSPACE:8,TAB:9,ENTER:13,PAUSE:19,CAPS:20,ESC:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,INSERT:45,DELETE:46,_0:48,_1:49,_2:50,_3:51,_4:52,_5:53,_6:54,_7:55,_8:56,_9:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,NUMPAD_0:96,NUMPAD_1:97,NUMPAD_2:98,NUMPAD_3:99,NUMPAD_4:100,NUMPAD_5:101,NUMPAD_6:102,NUMPAD_7:103,NUMPAD_8:104,NUMPAD_9:105,MULTIPLY:106,ADD:107,SUBSTRACT:109,DECIMAL:110,DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,SHIFT:16,CTRL:17,ALT:18,PLUS:187,COMMA:188,MINUS:189,PERIOD:190}},function(t,e,i){"use strict";var n=function(t,e){this.ctx=e,this.canvas=t,this.top=t.height,this.left=t.width,this.bottom=0,this.right=0,this.isDirty=!1};n.prototype.addRect=function(t,e,i,n){var o=t+i,s=e+n;this.top=e<this.top?e:this.top,this.left=t<this.left?t:this.left,this.bottom=s>this.bottom?s:this.bottom,this.right=o>this.right?o:this.right,this.isDirty=!0},n.prototype.clear=function(){this.isDirty&&(this.ctx.clearRect(this.left,this.top,this.right-this.left,this.bottom-this.top),this.left=this.canvas.width,this.top=this.canvas.height,this.right=0,this.bottom=0,this.isDirty=!1)},t.exports=n},function(t,e,i){(function(t,n){"use strict";function o(t,i){var n={seen:[],stylize:r};return arguments.length>=3&&(n.depth=arguments[2]),arguments.length>=4&&(n.colors=arguments[3]),g(i)?n.showHidden=i:i&&e._extend(n,i),_(n.showHidden)&&(n.showHidden=!1),_(n.depth)&&(n.depth=2),_(n.colors)&&(n.colors=!1),_(n.customInspect)&&(n.customInspect=!0),n.colors&&(n.stylize=s),u(n,t,n.depth)}function s(t,e){var i=o.styles[e];return i?"["+o.colors[i][0]+"m"+t+"["+o.colors[i][1]+"m":t}function r(t,e){return t}function a(t){var e={};return t.forEach(function(t,i){e[t]=!0}),e}function u(t,i,n){if(t.customInspect&&i&&D(i.inspect)&&i.inspect!==e.inspect&&(!i.constructor||i.constructor.prototype!==i)){var o=i.inspect(n,t);return w(o)||(o=u(t,o,n)),o}var s=c(t,i);if(s)return s;var r=Object.keys(i),g=a(r);if(t.showHidden&&(r=Object.getOwnPropertyNames(i)),T(i)&&(r.indexOf("message")>=0||r.indexOf("description")>=0))return h(i);if(0===r.length){if(D(i)){var v=i.name?": "+i.name:"";return t.stylize("[Function"+v+"]","special")}if(b(i))return t.stylize(RegExp.prototype.toString.call(i),"regexp");if(S(i))return t.stylize(Date.prototype.toString.call(i),"date");if(T(i))return h(i)}var y="",m=!1,x=["{","}"];if(l(i)&&(m=!0,x=["[","]"]),D(i)){var _=i.name?": "+i.name:"";y=" [Function"+_+"]"}if(b(i)&&(y=" "+RegExp.prototype.toString.call(i)),S(i)&&(y=" "+Date.prototype.toUTCString.call(i)),T(i)&&(y=" "+h(i)),0===r.length&&(!m||0==i.length))return x[0]+y+x[1];if(0>n)return b(i)?t.stylize(RegExp.prototype.toString.call(i),"regexp"):t.stylize("[Object]","special");t.seen.push(i);var O;return O=m?p(t,i,n,g,r):r.map(function(e){return d(t,i,n,g,e,m)}),t.seen.pop(),f(O,y,x)}function c(t,e){if(_(e))return t.stylize("undefined","undefined");if(w(e)){var i="'"+JSON.stringify(e).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return t.stylize(i,"string")}return m(e)?t.stylize(""+e,"number"):g(e)?t.stylize(""+e,"boolean"):v(e)?t.stylize("null","null"):void 0}function h(t){return"["+Error.prototype.toString.call(t)+"]"}function p(t,e,i,n,o){for(var s=[],r=0,a=e.length;a>r;++r)s.push(F(e,String(r))?d(t,e,i,n,String(r),!0):"");return o.forEach(function(o){o.match(/^\d+$/)||s.push(d(t,e,i,n,o,!0))}),s}function d(t,e,i,n,o,s){var r,a,c;if(c=Object.getOwnPropertyDescriptor(e,o)||{value:e[o]},c.get?a=c.set?t.stylize("[Getter/Setter]","special"):t.stylize("[Getter]","special"):c.set&&(a=t.stylize("[Setter]","special")),F(n,o)||(r="["+o+"]"),a||(t.seen.indexOf(c.value)<0?(a=v(i)?u(t,c.value,null):u(t,c.value,i-1),a.indexOf("\n")>-1&&(a=s?a.split("\n").map(function(t){return"  "+t}).join("\n").substr(2):"\n"+a.split("\n").map(function(t){return"   "+t}).join("\n"))):a=t.stylize("[Circular]","special")),_(r)){if(s&&o.match(/^\d+$/))return a;r=JSON.stringify(""+o),r.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(r=r.substr(1,r.length-2),r=t.stylize(r,"name")):(r=r.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),r=t.stylize(r,"string"))}return r+": "+a}function f(t,e,i){var n=0,o=t.reduce(function(t,e){return n++,e.indexOf("\n")>=0&&n++,t+e.replace(/\u001b\[\d\d?m/g,"").length+1},0);return o>60?i[0]+(""===e?"":e+"\n ")+" "+t.join(",\n  ")+" "+i[1]:i[0]+e+" "+t.join(", ")+" "+i[1]}function l(t){return Array.isArray(t)}function g(t){return"boolean"==typeof t}function v(t){return null===t}function y(t){return null==t}function m(t){return"number"==typeof t}function w(t){return"string"==typeof t}function x(t){return"symbol"==typeof t}function _(t){return void 0===t}function b(t){return O(t)&&"[object RegExp]"===k(t)}function O(t){return"object"==typeof t&&null!==t}function S(t){return O(t)&&"[object Date]"===k(t)}function T(t){return O(t)&&("[object Error]"===k(t)||t instanceof Error)}function D(t){return"function"==typeof t}function E(t){return null===t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||"symbol"==typeof t||"undefined"==typeof t}function k(t){return Object.prototype.toString.call(t)}function L(t){return 10>t?"0"+t.toString(10):t.toString(10)}function A(){var t=new Date,e=[L(t.getHours()),L(t.getMinutes()),L(t.getSeconds())].join(":");return[t.getDate(),P[t.getMonth()],e].join(" ")}function F(t,e){return Object.prototype.hasOwnProperty.call(t,e)}var C=/%[sdj%]/g;e.format=function(t){if(!w(t)){for(var e=[],i=0;i<arguments.length;i++)e.push(o(arguments[i]));return e.join(" ")}for(var i=1,n=arguments,s=n.length,r=String(t).replace(C,function(t){if("%%"===t)return"%";if(i>=s)return t;switch(t){case"%s":return String(n[i++]);case"%d":return Number(n[i++]);case"%j":try{return JSON.stringify(n[i++])}catch(e){return"[Circular]"}default:return t}}),a=n[i];s>i;a=n[++i])r+=v(a)||!O(a)?" "+a:" "+o(a);return r},e.deprecate=function(i,o){function s(){if(!r){if(n.throwDeprecation)throw new Error(o);n.traceDeprecation?console.trace(o):console.error(o),r=!0}return i.apply(this,arguments)}if(_(t.process))return function(){return e.deprecate(i,o).apply(this,arguments)};if(n.noDeprecation===!0)return i;var r=!1;return s};var z,M={};e.debuglog=function(t){if(_(z)&&(z=n.env.NODE_DEBUG||""),t=t.toUpperCase(),!M[t])if(new RegExp("\\b"+t+"\\b","i").test(z)){var i=n.pid;M[t]=function(){var n=e.format.apply(e,arguments);console.error("%s %d: %s",t,i,n)}}else M[t]=function(){};return M[t]},e.inspect=o,o.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},o.styles={special:"cyan",number:"yellow","boolean":"yellow",undefined:"grey","null":"bold",string:"green",date:"magenta",regexp:"red"},e.isArray=l,e.isBoolean=g,e.isNull=v,e.isNullOrUndefined=y,e.isNumber=m,e.isString=w,e.isSymbol=x,e.isUndefined=_,e.isRegExp=b,e.isObject=O,e.isDate=S,e.isError=T,e.isFunction=D,e.isPrimitive=E,e.isBuffer=i(17);var P=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];e.log=function(){console.log("%s - %s",A(),e.format.apply(e,arguments))},e.inherits=i(19),e._extend=function(t,e){if(!e||!O(e))return t;for(var i=Object.keys(e),n=i.length;n--;)t[i[n]]=e[i[n]];return t}}).call(e,function(){return this}(),i(16))},function(t,e,i){"use strict";var n=function(){var t="(-webkit-min-device-pixel-ratio: 1.5),  (min--moz-device-pixel-ratio: 1.5),  (-o-min-device-pixel-ratio: 3/2),  (min-resolution: 1.5dppx)";return window.devicePixelRatio>1?!0:window.matchMedia&&window.matchMedia(t).matches?!0:!1};t.exports=n},function(t,e,i){"use strict";var n=e.get=function(t,e){var i=new XMLHttpRequest;i.open("GET",t,!0),i.onload=function(){e(this.response)},i.send()};e.getJSON=function(t,e){n(t,function(t){e(JSON.parse(t))})},e.isFunction=function(t){return!!(t&&t.constructor&&t.call&&t.apply)}},function(t,e,i){"use strict";t.exports=i(18)},function(t,e,i){"use strict";function n(){if(!a){a=!0;for(var t,e=r.length;e;){t=r,r=[];for(var i=-1;++i<e;)t[i]();e=r.length}a=!1}}function o(){}var s=t.exports={},r=[],a=!1;s.nextTick=function(t){r.push(t),a||setTimeout(n,0)},s.title="browser",s.browser=!0,s.env={},s.argv=[],s.version="",s.versions={},s.on=o,s.addListener=o,s.once=o,s.off=o,s.removeListener=o,s.removeAllListeners=o,s.emit=o,s.binding=function(t){throw new Error("process.binding is not supported")},s.cwd=function(){return"/"},s.chdir=function(t){throw new Error("process.chdir is not supported")},s.umask=function(){return 0}},function(t,e,i){"use strict";t.exports=function(t){return t&&"object"==typeof t&&"function"==typeof t.copy&&"function"==typeof t.fill&&"function"==typeof t.readUInt8}},function(t,e,i){"use strict";var n=i(20),o=function(){var t=window.AudioContext||window.webkitAudioContext;this.ctx=new t,this.masterGain=this.ctx.createGain(),this._volume=1;var e=/(iPad|iPhone|iPod)/g.test(navigator.userAgent);e&&this._enableiOS()};o.prototype._enableiOS=function(){var t=this,e=function(t){var e=function(){return t.apply(this,arguments)};return e.toString=function(){return t.toString()},e}(function(){var i=t.ctx.createBuffer(1,1,22050),n=t.ctx.createBufferSource();n.buffer=i,n.connect(t.ctx.destination),n.start(0),window.removeEventListener("touchstart",e,!1)});window.addEventListener("touchstart",e,!1)},o.prototype.setVolume=function(t){this._volume=t,this.masterGain.gain.value=t},o.prototype.load=function(t,e){var i=this,n=new XMLHttpRequest;n.open("GET",t,!0),n.responseType="arraybuffer",n.onload=function(){i.decodeAudioData(n.response,function(t){e(t)})},n.send()},o.prototype.decodeAudioData=function(t,e){var i=this;this.ctx.decodeAudioData(t,function(t){var o=new n(i.ctx,t,i.masterGain);e(o)})},t.exports=o},function(t,e,i){"use strict";t.exports="function"==typeof Object.create?function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:function(t,e){t.super_=e;var i=function(){};i.prototype=e.prototype,t.prototype=new i,t.prototype.constructor=t}},function(t,e,i){"use strict";var n=i(21),o=function(t,e,i){this._ctx=t,this._masterGain=i,this._buffer=e,this._buffer.loop=!1};o.prototype.play=function(){var t=this._ctx.createBufferSource();t.buffer=this._buffer;var e=this._ctx.createGain();return t.connect(this._masterGain),this._masterGain.connect(e),e.connect(this._ctx.destination),t.start(0),new n(t,e)},o.prototype.fadeIn=function(t,e){var i=this._ctx.createBufferSource();i.buffer=this._buffer;var o=this._ctx.createGain();return o.gain.setValueAtTime(0,0),o.gain.linearRampToValueAtTime(.01,0),o.gain.linearRampToValueAtTime(t,e),i.connect(this._masterGain),this._masterGain.connect(o),o.connect(this._ctx.destination),i.start(0),new n(i,o)},o.prototype.loop=function(){var t=this._ctx.createBufferSource();t.buffer=this._buffer;var e=this._ctx.createGain();return t.connect(e),e.connect(this._ctx.destination),t.loop=!0,t.start(0),new n(t,e)},t.exports=o},function(t,e,i){"use strict";var n=function(t,e){this._gain=e,this._source=t};n.prototype.setVolume=function(t){
this._gain.gain.value=t},n.prototype.stop=function(){this._source.stop(0)},t.exports=n}])});