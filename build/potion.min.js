/**
 * potion - v0.10.2
 * Copyright (c) 2015, Jan Sedivy
 *
 * Compiled: 2015-04-01
 *
 * potion is licensed under the MIT License.
 */
!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b){var c=a("./src/engine");b.exports={init:function(a,b){var d=new c(a,b);return d.game}}},{"./src/engine":13}],2:[function(a,b){b.exports="function"==typeof Object.create?function(a,b){a.super_=b,a.prototype=Object.create(b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}})}:function(a,b){a.super_=b;var c=function(){};c.prototype=b.prototype,a.prototype=new c,a.prototype.constructor=a}},{}],3:[function(a,b){function c(){if(!g){g=!0;for(var a,b=f.length;b;){a=f,f=[];for(var c=-1;++c<b;)a[c]();b=f.length}g=!1}}function d(){}var e=b.exports={},f=[],g=!1;e.nextTick=function(a){f.push(a),g||setTimeout(c,0)},e.title="browser",e.browser=!0,e.env={},e.argv=[],e.version="",e.versions={},e.on=d,e.addListener=d,e.once=d,e.off=d,e.removeListener=d,e.removeAllListeners=d,e.emit=d,e.binding=function(){throw new Error("process.binding is not supported")},e.cwd=function(){return"/"},e.chdir=function(){throw new Error("process.chdir is not supported")},e.umask=function(){return 0}},{}],4:[function(a,b){b.exports=function(a){return a&&"object"==typeof a&&"function"==typeof a.copy&&"function"==typeof a.fill&&"function"==typeof a.readUInt8}},{}],5:[function(a,b,c){(function(b,d){function e(a,b){var d={seen:[],stylize:g};return arguments.length>=3&&(d.depth=arguments[2]),arguments.length>=4&&(d.colors=arguments[3]),p(b)?d.showHidden=b:b&&c._extend(d,b),v(d.showHidden)&&(d.showHidden=!1),v(d.depth)&&(d.depth=2),v(d.colors)&&(d.colors=!1),v(d.customInspect)&&(d.customInspect=!0),d.colors&&(d.stylize=f),i(d,a,d.depth)}function f(a,b){var c=e.styles[b];return c?"["+e.colors[c][0]+"m"+a+"["+e.colors[c][1]+"m":a}function g(a){return a}function h(a){var b={};return a.forEach(function(a){b[a]=!0}),b}function i(a,b,d){if(a.customInspect&&b&&A(b.inspect)&&b.inspect!==c.inspect&&(!b.constructor||b.constructor.prototype!==b)){var e=b.inspect(d,a);return t(e)||(e=i(a,e,d)),e}var f=j(a,b);if(f)return f;var g=Object.keys(b),p=h(g);if(a.showHidden&&(g=Object.getOwnPropertyNames(b)),z(b)&&(g.indexOf("message")>=0||g.indexOf("description")>=0))return k(b);if(0===g.length){if(A(b)){var q=b.name?": "+b.name:"";return a.stylize("[Function"+q+"]","special")}if(w(b))return a.stylize(RegExp.prototype.toString.call(b),"regexp");if(y(b))return a.stylize(Date.prototype.toString.call(b),"date");if(z(b))return k(b)}var r="",s=!1,u=["{","}"];if(o(b)&&(s=!0,u=["[","]"]),A(b)){var v=b.name?": "+b.name:"";r=" [Function"+v+"]"}if(w(b)&&(r=" "+RegExp.prototype.toString.call(b)),y(b)&&(r=" "+Date.prototype.toUTCString.call(b)),z(b)&&(r=" "+k(b)),0===g.length&&(!s||0==b.length))return u[0]+r+u[1];if(0>d)return w(b)?a.stylize(RegExp.prototype.toString.call(b),"regexp"):a.stylize("[Object]","special");a.seen.push(b);var x;return x=s?l(a,b,d,p,g):g.map(function(c){return m(a,b,d,p,c,s)}),a.seen.pop(),n(x,r,u)}function j(a,b){if(v(b))return a.stylize("undefined","undefined");if(t(b)){var c="'"+JSON.stringify(b).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return a.stylize(c,"string")}return s(b)?a.stylize(""+b,"number"):p(b)?a.stylize(""+b,"boolean"):q(b)?a.stylize("null","null"):void 0}function k(a){return"["+Error.prototype.toString.call(a)+"]"}function l(a,b,c,d,e){for(var f=[],g=0,h=b.length;h>g;++g)f.push(F(b,String(g))?m(a,b,c,d,String(g),!0):"");return e.forEach(function(e){e.match(/^\d+$/)||f.push(m(a,b,c,d,e,!0))}),f}function m(a,b,c,d,e,f){var g,h,j;if(j=Object.getOwnPropertyDescriptor(b,e)||{value:b[e]},j.get?h=j.set?a.stylize("[Getter/Setter]","special"):a.stylize("[Getter]","special"):j.set&&(h=a.stylize("[Setter]","special")),F(d,e)||(g="["+e+"]"),h||(a.seen.indexOf(j.value)<0?(h=q(c)?i(a,j.value,null):i(a,j.value,c-1),h.indexOf("\n")>-1&&(h=f?h.split("\n").map(function(a){return"  "+a}).join("\n").substr(2):"\n"+h.split("\n").map(function(a){return"   "+a}).join("\n"))):h=a.stylize("[Circular]","special")),v(g)){if(f&&e.match(/^\d+$/))return h;g=JSON.stringify(""+e),g.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(g=g.substr(1,g.length-2),g=a.stylize(g,"name")):(g=g.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),g=a.stylize(g,"string"))}return g+": "+h}function n(a,b,c){var d=0,e=a.reduce(function(a,b){return d++,b.indexOf("\n")>=0&&d++,a+b.replace(/\u001b\[\d\d?m/g,"").length+1},0);return e>60?c[0]+(""===b?"":b+"\n ")+" "+a.join(",\n  ")+" "+c[1]:c[0]+b+" "+a.join(", ")+" "+c[1]}function o(a){return Array.isArray(a)}function p(a){return"boolean"==typeof a}function q(a){return null===a}function r(a){return null==a}function s(a){return"number"==typeof a}function t(a){return"string"==typeof a}function u(a){return"symbol"==typeof a}function v(a){return void 0===a}function w(a){return x(a)&&"[object RegExp]"===C(a)}function x(a){return"object"==typeof a&&null!==a}function y(a){return x(a)&&"[object Date]"===C(a)}function z(a){return x(a)&&("[object Error]"===C(a)||a instanceof Error)}function A(a){return"function"==typeof a}function B(a){return null===a||"boolean"==typeof a||"number"==typeof a||"string"==typeof a||"symbol"==typeof a||"undefined"==typeof a}function C(a){return Object.prototype.toString.call(a)}function D(a){return 10>a?"0"+a.toString(10):a.toString(10)}function E(){var a=new Date,b=[D(a.getHours()),D(a.getMinutes()),D(a.getSeconds())].join(":");return[a.getDate(),J[a.getMonth()],b].join(" ")}function F(a,b){return Object.prototype.hasOwnProperty.call(a,b)}var G=/%[sdj%]/g;c.format=function(a){if(!t(a)){for(var b=[],c=0;c<arguments.length;c++)b.push(e(arguments[c]));return b.join(" ")}for(var c=1,d=arguments,f=d.length,g=String(a).replace(G,function(a){if("%%"===a)return"%";if(c>=f)return a;switch(a){case"%s":return String(d[c++]);case"%d":return Number(d[c++]);case"%j":try{return JSON.stringify(d[c++])}catch(b){return"[Circular]"}default:return a}}),h=d[c];f>c;h=d[++c])g+=q(h)||!x(h)?" "+h:" "+e(h);return g},c.deprecate=function(a,e){function f(){if(!g){if(b.throwDeprecation)throw new Error(e);b.traceDeprecation?console.trace(e):console.error(e),g=!0}return a.apply(this,arguments)}if(v(d.process))return function(){return c.deprecate(a,e).apply(this,arguments)};if(b.noDeprecation===!0)return a;var g=!1;return f};var H,I={};c.debuglog=function(a){if(v(H)&&(H=b.env.NODE_DEBUG||""),a=a.toUpperCase(),!I[a])if(new RegExp("\\b"+a+"\\b","i").test(H)){var d=b.pid;I[a]=function(){var b=c.format.apply(c,arguments);console.error("%s %d: %s",a,d,b)}}else I[a]=function(){};return I[a]},c.inspect=e,e.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},e.styles={special:"cyan",number:"yellow","boolean":"yellow",undefined:"grey","null":"bold",string:"green",date:"magenta",regexp:"red"},c.isArray=o,c.isBoolean=p,c.isNull=q,c.isNullOrUndefined=r,c.isNumber=s,c.isString=t,c.isSymbol=u,c.isUndefined=v,c.isRegExp=w,c.isObject=x,c.isDate=y,c.isError=z,c.isFunction=A,c.isPrimitive=B,c.isBuffer=a("./support/isBuffer");var J=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];c.log=function(){console.log("%s - %s",E(),c.format.apply(c,arguments))},c.inherits=a("inherits"),c._extend=function(a,b){if(!b||!x(b))return a;for(var c=Object.keys(b),d=c.length;d--;)a[c[d]]=b[c[d]];return a}}).call(this,a("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":4,_process:3,inherits:2}],6:[function(a,b){b.exports=a("./src/audio-manager")},{"./src/audio-manager":7}],7:[function(a,b){var c=a("./loaded-audio"),d=function(){var a=window.AudioContext||window.webkitAudioContext;this.ctx=new a,this.masterGain=this.ctx.createGain(),this._volume=1;var b=/(iPad|iPhone|iPod)/g.test(navigator.userAgent);b&&this._enableiOS()};d.prototype._enableiOS=function(){var a=this,b=function(){var c=a.ctx.createBuffer(1,1,22050),d=a.ctx.createBufferSource();d.buffer=c,d.connect(a.ctx.destination),d.start(0),window.removeEventListener("touchstart",b,!1)};window.addEventListener("touchstart",b,!1)},d.prototype.setVolume=function(a){this._volume=a,this.masterGain.gain.value=a},d.prototype.load=function(a,b){var c=this,d=new XMLHttpRequest;d.open("GET",a,!0),d.responseType="arraybuffer",d.onload=function(){c.decodeAudioData(d.response,function(a){b(a)})},d.send()},d.prototype.decodeAudioData=function(a,b){var d=this;this.ctx.decodeAudioData(a,function(a){var e=new c(d.ctx,a,d.masterGain);b(e)})},b.exports=d},{"./loaded-audio":8}],8:[function(a,b){var c=a("./playing-audio"),d=function(a,b,c){this._ctx=a,this._masterGain=c,this._buffer=b,this._buffer.loop=!1};d.prototype.play=function(){var a=this._ctx.createBufferSource();a.buffer=this._buffer;var b=this._ctx.createGain();return a.connect(this._masterGain),this._masterGain.connect(b),b.connect(this._ctx.destination),a.start(0),new c(a,b)},d.prototype.fadeIn=function(a,b){var d=this._ctx.createBufferSource();d.buffer=this._buffer;var e=this._ctx.createGain();return e.gain.setValueAtTime(0,0),e.gain.linearRampToValueAtTime(.01,0),e.gain.linearRampToValueAtTime(a,b),d.connect(this._masterGain),this._masterGain.connect(e),e.connect(this._ctx.destination),d.start(0),new c(d,e)},d.prototype.loop=function(){var a=this._ctx.createBufferSource();a.buffer=this._buffer;var b=this._ctx.createGain();return a.connect(b),b.connect(this._ctx.destination),a.loop=!0,a.start(0),new c(a,b)},b.exports=d},{"./playing-audio":9}],9:[function(a,b){var c=function(a,b){this._gain=b,this._source=a};c.prototype.setVolume=function(a){this._gain.gain.value=a},c.prototype.stop=function(){this._source.stop(0)},b.exports=c},{}],10:[function(a,b){var c=function(a,b){this.ctx=b,this.canvas=a,this.top=a.height,this.left=a.width,this.bottom=0,this.right=0,this.isDirty=!1};c.prototype.addRect=function(a,b,c,d){var e=a+c,f=b+d;this.top=b<this.top?b:this.top,this.left=a<this.left?a:this.left,this.bottom=f>this.bottom?f:this.bottom,this.right=e>this.right?e:this.right,this.isDirty=!0},c.prototype.clear=function(){this.isDirty&&(this.ctx.clearRect(this.left,this.top,this.right-this.left,this.bottom-this.top),this.left=this.canvas.width,this.top=this.canvas.height,this.right=0,this.bottom=0,this.isDirty=!1)},b.exports=c},{}],11:[function(a,b){var c=a("util"),d=a("./dirty-manager"),e=[],f=function(){var a=e.pop();return a?a:{}},g=function(a){return 9>=a?48+a:10===a?48:a>10&&36>=a?64+(a-10):null},h=[{name:"Show FPS",entry:"showFps","default":!0},{name:"Show Key Codes",entry:"showKeyCodes","default":!0},{name:"Show Time",entry:"showTime","default":!0}],i=function(a){this.video=a.video.createLayer({useRetina:!0,initializeCanvas:!0}),this.app=a,this.options=h,this._maxLogsCounts=10;for(var b=0;b<this.options.length;b++){var c=this.options[b];this._initOption(c)}this.disabled=!1,this.fps=0,this.fpsCount=0,this.fpsElapsedTime=0,this.fpsUpdateInterval=.5,this._fontSize=0,this._dirtyManager=new d(this.video.canvas,this.video.ctx),this.logs=[],this.showDebug=!1,this.enableDebugKeys=!0,this.enableShortcuts=!1,this.enableShortcutsKey=220,this.lastKey=null,this._load(),this.keyShortcuts=[{key:123,entry:"showDebug",type:"toggle"}]};i.prototype._setFont=function(a,b){this._fontSize=a,this.video.ctx.font=a+"px "+b},i.prototype.resize=function(){this.video.setSize(this.app.width,this.app.height)},i.prototype.addConfig=function(a){this.options.push(a),this._initOption(a)},i.prototype._initOption=function(a){a.type=a.type||"toggle",a["default"]=null==a["default"]?!1:a["default"],"toggle"===a.type&&(this[a.entry]=a["default"])},i.prototype.clear=function(){this.logs.length=0},i.prototype.log=function(a,b){b=b||"white",a="string"==typeof a?a:c.inspect(a);for(var d=a.replace(/\\'/g,"'").split("\n"),g=0;g<d.length;g++){var h=d[g];this.logs.length>=this._maxLogsCounts&&e.push(this.logs.shift());var i=f();i.text=h,i.life=10,i.color=b,this.logs.push(i)}},i.prototype.update=function(){},i.prototype.exitUpdate=function(a){if(!this.disabled&&this.showDebug){if(this._maxLogsCounts=Math.ceil((this.app.height+20)/20),this.fpsCount+=1,this.fpsElapsedTime+=a,this.fpsElapsedTime>this.fpsUpdateInterval){var b=this.fpsCount/this.fpsElapsedTime;this.showFps&&(this.fps=this.fps*(1-.8)+.8*b),this.fpsCount=0,this.fpsElapsedTime=0}for(var c=0,d=this.logs.length;d>c;c++){var e=this.logs[c];if(e&&(e.life-=a,e.life<=0)){var f=this.logs.indexOf(e);f>-1&&this.logs.splice(f,1)}}}},i.prototype.keydown=function(a){if(!this.disabled){this.lastKey=a;var b;if(this.enableDebugKeys){if(a===this.enableShortcutsKey)return this.enableShortcuts=!this.enableShortcuts,!0;if(this.enableShortcuts)for(b=0;b<this.options.length;b++){var c=this.options[b],d=b+1;this.app.input.isKeyDown("ctrl")&&(d-=36);var e=g(d);if(e&&a===e)return"toggle"===c.type?(this[c.entry]=!this[c.entry],this._save()):"call"===c.type&&c.entry(),!0}}for(b=0;b<this.keyShortcuts.length;b++){var f=this.keyShortcuts[b];if(f.key===a)return"toggle"===f.type?(this[f.entry]=!this[f.entry],this._save()):"call"===f.type&&this[f.entry](),!0}return!1}},i.prototype._save=function(){for(var a={showDebug:this.showDebug,options:{}},b=0;b<this.options.length;b++){var c=this.options[b],d=this[c.entry];a.options[c.entry]=d}window.localStorage.__potionDebug=JSON.stringify(a)},i.prototype._load=function(){if(window.localStorage&&window.localStorage.__potionDebug){var a=JSON.parse(window.localStorage.__potionDebug);this.showDebug=a.showDebug;for(var b in a.options)this[b]=a.options[b]}},i.prototype.render=function(){this.disabled||(this._dirtyManager.clear(),this.showDebug&&(this.video.ctx.save(),this._setFont(15,"sans-serif"),this._renderLogs(),this._renderData(),this._renderShortcuts(),this.video.ctx.restore()))},i.prototype._renderLogs=function(){this.video.ctx.textAlign="left",this.video.ctx.textBaseline="bottom";for(var a=0,b=this.logs.length;b>a;a++){var c=this.logs[a],d=-10+this.app.height+20*(a-this.logs.length+1);this._renderText(c.text,10,d,c.color)}},i.prototype.disable=function(){this.disabled=!0},i.prototype._renderData=function(){this.video.ctx.textAlign="right",this.video.ctx.textBaseline="top";var a=this.app.width-14,b=14;this.showFps&&this._renderText(Math.round(this.fps)+" fps",a,b),b+=20,this._setFont(15,"sans-serif"),this.showKeyCodes&&(this._renderText("key "+this.lastKey,a,b,this.app.input.isKeyDown(this.lastKey)?"#e9dc7c":"white"),this._renderText("btn "+this.app.input.mouse.button,a-60,b,this.app.input.mouse.isDown?"#e9dc7c":"white"))},i.prototype._renderShortcuts=function(){if(this.enableShortcuts){var a=28;this._setFont(20,"Helvetica Neue, sans-serif"),this.video.ctx.textAlign="left",this.video.ctx.textBaseline="top";for(var b=Math.floor((this.app.height-14)/a),c=0;c<this.options.length;c++){var d=this.options[c],e=14+320*Math.floor(c/b),f=14+c%b*a,h=c+1,i=g(h),j=this[d.entry],k=String.fromCharCode(i);i||(k="^+"+String.fromCharCode(g(h-36)));var l="["+k+"] "+d.name;"toggle"===d.type?l+=" ("+(j?"ON":"OFF")+")":"call"===d.type&&(l+=" (CALL)");var m="rgba(255, 255, 255, 1)",n="rgba(0, 0, 0, 1)";j||(m="rgba(255, 255, 255, .7)",n="rgba(0, 0, 0, .7)"),this._renderText(l,e,f,m,n)}}},i.prototype._renderText=function(a,b,c,d,e){d=d||"white",e=e||"black",this.video.ctx.fillStyle=d,this.video.ctx.lineJoin="round",this.video.ctx.strokeStyle=e,this.video.ctx.lineWidth=3,this.video.ctx.strokeText(a,b,c),this.video.ctx.fillText(a,b,c);var f=this.video.ctx.measureText(a).width,g=b-5,h=c,i=f+10,j=this._fontSize+10;"right"===this.video.ctx.textAlign&&(g=b-5-f),this._dirtyManager.addRect(g,h,i,j)},b.exports=i},{"./dirty-manager":10,util:5}],12:[function(a,b){(function(c){var d=a("./utils"),e=a("potion-audio"),f=function(){this.isLoading=!1,this.itemsCount=0,this.loadedItemsCount=0,this.progress=0,this._xhr=new XMLHttpRequest,this._thingsToLoad=0,this._data={},this.callback=null,this._toLoad=[],this.audio=new e};f.prototype.onload=function(a){this.callback=a,0===this._thingsToLoad?(this.isLoading=!1,c.nextTick(function(){a()})):this._nextFile()},f.prototype.get=function(a){return this._data[a]},f.prototype.set=function(a,b){this._data[a]=b},f.prototype.load=function(a,b,c){this.isLoading=!0,this.itemsCount+=1,this._thingsToLoad+=1,this._toLoad.push({type:a,url:b,callback:c})},f.prototype._finishedOneFile=function(){if(this._nextFile(),this.progress=this.loadedItemsCount/this.itemsCount,this._thingsToLoad-=1,this.loadedItemsCount+=1,0===this._thingsToLoad){var a=this;setTimeout(function(){a.callback(),a.isLoading=!1},0)}},f.prototype._error=function(a,b){console.warn('Error loading "'+a+'" asset with url '+b),this._nextFile()},f.prototype._save=function(a,b,c){this.set(a,b),c&&c(b),this._finishedOneFile()},f.prototype._handleCustomLoading=function(a){var b=this,c=function(a,c){b._save(a,c)};a(c)},f.prototype._nextFile=function(){var a=this._toLoad.shift();if(a){var b=a.type,c=a.url,e=a.callback,f=this;if(d.isFunction(b))return void this._handleCustomLoading(b);b=b.toLowerCase();var g=this._xhr;switch(b){case"json":g.open("GET",c,!0),g.responseType="text",g.onload=function(){var a=JSON.parse(this.response);f._save(c,a,e)},g.onerror=function(){f._error(b,c)},g.send();break;case"mp3":case"music":case"sound":f.audio.load(c,function(a){f._save(c,a,e)});break;case"image":case"texture":case"sprite":var h=new Image;h.onload=function(){f._save(c,h,e)},h.onerror=function(){f._error(b,c)},h.src=c;break;default:g.open("GET",c,!0),g.responseType="text",g.onload=function(){var a=this.response;f._save(c,a,e)},g.onerror=function(){f._error(b,c)},g.send()}}},b.exports=f}).call(this,a("_process"))},{"./utils":21,_process:3,"potion-audio":6}],13:[function(a,b){a("./raf-polyfill")();var c=a("./game"),d=a("./input"),e=a("./time"),f=a("potion-debugger"),g=a("./state-manager"),h=function(a,b){var c=this._subclassGame(a,b);a.style.position="relative";var g=document.createElement("canvas");g.style.display="block",a.appendChild(g),this.game=new c(g),this.game.debug=new f(this.game),this._setDefaultStates(),this.game.config.addInputEvents&&(this.game.input=new d(this.game,a)),this.tickFunc=function(a){return function(){a.tick()}}(this),this.preloaderTickFunc=function(a){return function(){a._preloaderTick()}}(this),this.strayTime=0,this._time=e.now(),this.game.assets.onload(function(){this.start(),window.cancelAnimationFrame(this.preloaderId),window.requestAnimationFrame(this.tickFunc)}.bind(this)),this.game.assets.isLoading&&(this.preloaderId=window.requestAnimationFrame(this.preloaderTickFunc))};h.prototype.addEvents=function(){{var a=this;a.game}window.addEventListener("blur",function(){a.game.input.resetKeys(),a.game.blur()}),window.addEventListener("focus",function(){a.game.input.resetKeys(),a.game.focus()})},h.prototype.start=function(){this.game.config.addInputEvents&&this.addEvents()},h.prototype.tick=function(){window.requestAnimationFrame(this.tickFunc);var a=e.now(),b=(a-this._time)/1e3;this._time=a,this.update(b),this.game.states.exitUpdate(b),this.render()},h.prototype.update=function(a){if(a>this.game.config.maxStepTime&&(a=this.game.config.maxStepTime),this.game.config.fixedStep)for(this.strayTime=this.strayTime+a;this.strayTime>=this.game.config.stepTime;)this.strayTime=this.strayTime-this.game.config.stepTime,this.game.states.update(this.game.config.stepTime);else this.game.states.update(a)},h.prototype.render=function(){this.game.video.beginFrame(),this.game.video.clear(),this.game.states.render(),this.game.video.endFrame()},h.prototype._preloaderTick=function(){this.preloaderId=window.requestAnimationFrame(this.preloaderTickFunc);var a=e.now(),b=(a-this._time)/1e3;this._time=a,this.game.config.showPreloader&&(this.game.video.clear(),this.game.preloading(b))},h.prototype._setDefaultStates=function(){var a=new g;a.add("app",this.game),a.add("debug",this.game.debug),a.protect("app"),a.protect("debug"),this.game.states=a},h.prototype._subclassGame=function(a,b){var d=function(a){c.call(this,a)};d.prototype=Object.create(c.prototype);for(var e in b)d.prototype[e]=b[e];return d},b.exports=h},{"./game":14,"./input":15,"./raf-polyfill":17,"./state-manager":19,"./time":20,"potion-debugger":11}],14:[function(a,b){var c=a("./video"),d=a("./assets"),e=function(a){this.canvas=a,this.width=300,this.height=300,this.assets=new d,this.states=null,this.debug=null,this.config={useRetina:!0,initializeCanvas:!0,initializeVideo:!0,addInputEvents:!0,showPreloader:!0,fixedStep:!1,stepTime:.01666,maxStepTime:.01666},this.configure(),this.input=null,this.config.initializeVideo&&(this.video=new c(this,a,this.config))};e.prototype.init=function(){},e.prototype.configure=function(){},e.prototype.render=function(){},e.prototype.update=function(){},e.prototype.exitUpdate=function(){},e.prototype.setSize=function(a,b){this.width=a,this.height=b,this.video&&this.video.setSize(a,b),this.states&&this.states.resize()},e.prototype.preloading=function(a){if((this.config.showPreloader||this.video&&this.video.ctx)&&this.video.ctx){void 0===this._preloaderWidth&&(this._preloaderWidth=0);var b=Math.min(2*this.width/3,300),c=20,d=(this.height-c)/2,e=(this.width-b)/2,f=b*this.assets.progress;this._preloaderWidth=this._preloaderWidth+(f-this._preloaderWidth)*a*10,this.video.ctx.save(),this.video.ctx.fillStyle="#a9c848",this.video.ctx.fillRect(0,0,this.width,this.height),this.video.ctx.fillStyle="#f6ffda",this.video.ctx.font="300 40px sans-serif",this.video.ctx.textAlign="center",this.video.ctx.textBaseline="bottom",this.video.ctx.fillText("Potion.js",this.width/2,d),this.video.ctx.fillStyle="#88a237",this.video.ctx.fillRect(e,d+15,b,c),this.video.ctx.fillStyle="#f6ffda",this.video.ctx.fillRect(e,d+15,this._preloaderWidth,c),this.video.ctx.strokeStyle="#f6ffda",this.video.ctx.lineWidth=2,this.video.ctx.beginPath(),this.video.ctx.rect(e-5,d+10,this._preloaderWidth+10,c+10),this.video.ctx.closePath(),this.video.ctx.stroke(),this.video.ctx.restore()}},e.prototype.focus=function(){},e.prototype.blur=function(){},e.prototype.click=function(){},e.prototype.mousemove=function(){},e.prototype.mousedown=function(){},e.prototype.mouseup=function(){},e.prototype.keydown=function(){},e.prototype.keyup=function(){},e.prototype.resize=function(){},b.exports=e},{"./assets":12,"./video":22}],15:[function(a,b){var c=a("./keys"),d=function(a,b){this._container=b,this.keys={},this.canControlKeys=!0,this.mouse={isDown:!1,button:null,x:null,y:null},this._addEvents(a)};d.prototype.resetKeys=function(){this.keys={}},d.prototype.isKeyDown=function(a){if(null==a)return!1;if(this.canControlKeys){var b="number"==typeof a?a:c[a.toUpperCase()];return this.keys[b]}},d.prototype._addEvents=function(a){var b=this;b._container.addEventListener("mousemove",function(c){var d=void 0===c.offsetX?c.layerX-b._container.offsetLeft:c.offsetX,e=void 0===c.offsetY?c.layerY-b._container.offsetTop:c.offsetY;a.states.mousemove(d,e,c),b.mouse.x=d,b.mouse.y=e}),b._container.addEventListener("click",function(c){c.preventDefault();var d=void 0===c.offsetX?c.layerX-b._container.offsetLeft:c.offsetX,e=void 0===c.offsetY?c.layerY-b._container.offsetTop:c.offsetY;a.states.click(d,e,c.button)}),b._container.addEventListener("mouseup",function(c){c.preventDefault();var d=void 0===c.offsetX?c.layerX-b._container.offsetLeft:c.offsetX,e=void 0===c.offsetY?c.layerY-b._container.offsetTop:c.offsetY;switch(b.mouse.button=c.button,b.mouse.isDown=!1,c.button){case 0:b.mouse.isLeftDown=!1;break;case 1:b.mouse.isMiddleDown=!1;break;case 2:b.mouse.isRightDown=!1}a.states.mouseup(d,e,c.button)},!1),b._container.addEventListener("mousedown",function(c){c.preventDefault();var d=void 0===c.offsetX?c.layerX-b._container.offsetLeft:c.offsetX,e=void 0===c.offsetY?c.layerY-b._container.offsetTop:c.offsetY;switch(b.mouse.x=d,b.mouse.y=e,b.mouse.button=c.button,b.mouse.isDown=!0,c.button){case 0:b.mouse.isLeftDown=!0;break;case 1:b.mouse.isMiddleDown=!0;break;case 2:b.mouse.isRightDown=!0}a.states.mousedown(d,e,c.button)},!1);var c=null,d=null;b._container.addEventListener("touchstart",function(e){var f=e.layerX,g=e.layerY;c=f,d=g,b.mouse.x=f,b.mouse.y=g,b.mouse.isDown=!0,a.states.mousedown(f,g,e)}),b._container.addEventListener("touchmove",function(c){c.preventDefault();var d=c.layerX,e=c.layerY;a.states.mousemove(d,e,c),b.mouse.x=d,b.mouse.y=e}),b._container.addEventListener("touchend",function(e){e.preventDefault(),b.mouse.isDown=!1;for(var f=0,g=e.changedTouches.length;g>f;f++){var h=e.changedTouches[f],i=h.pageX-b._container.offsetLeft,j=h.pageY-b._container.offsetTop,k=0,l=Math.abs(c-i),m=Math.abs(d-j),n=5;n>l&&n>m&&(b.mouse.x=i,b.mouse.y=j,a.states.click(i,j,k))}}),b._container.addEventListener("contextmenu",function(a){a.preventDefault()}),document.addEventListener("keydown",function(b){a.input.keys[b.keyCode]=!0,a.states.keydown(b.which,b)}),document.addEventListener("keyup",function(b){a.input.keys[b.keyCode]=!1,a.states.keyup(b.which,b)}),document.addEventListener("keypress",function(b){a.states.keypress(b.which,b)})},b.exports=d},{"./keys":16}],16:[function(a,b){b.exports={MOUSE1:-1,MOUSE2:-3,MWHEEL_UP:-4,MWHEEL_DOWN:-5,BACKSPACE:8,TAB:9,ENTER:13,PAUSE:19,CAPS:20,ESC:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,INSERT:45,DELETE:46,_0:48,_1:49,_2:50,_3:51,_4:52,_5:53,_6:54,_7:55,_8:56,_9:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,NUMPAD_0:96,NUMPAD_1:97,NUMPAD_2:98,NUMPAD_3:99,NUMPAD_4:100,NUMPAD_5:101,NUMPAD_6:102,NUMPAD_7:103,NUMPAD_8:104,NUMPAD_9:105,MULTIPLY:106,ADD:107,SUBSTRACT:109,DECIMAL:110,DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,SHIFT:16,CTRL:17,ALT:18,PLUS:187,COMMA:188,MINUS:189,PERIOD:190}},{}],17:[function(a,b){b.exports=function(){for(var a=0,b=["ms","moz","webkit","o"],c=0;c<b.length&&!window.requestAnimationFrame;++c)window.requestAnimationFrame=window[b[c]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[b[c]+"CancelAnimationFrame"]||window[b[c]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(b){var c=(new Date).getTime(),d=Math.max(0,16-(c-a)),e=window.setTimeout(function(){b(c+d)},d);return a=c+d,e}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(a){clearTimeout(a)})}},{}],18:[function(a,b){var c=function(){var a="(-webkit-min-device-pixel-ratio: 1.5),  (min--moz-device-pixel-ratio: 1.5),  (-o-min-device-pixel-ratio: 3/2),  (min-resolution: 1.5dppx)";return window.devicePixelRatio>1?!0:window.matchMedia&&window.matchMedia(a).matches?!0:!1};b.exports=c},{}],19:[function(a,b){var c=function(a,b){return a.renderOrder<b.renderOrder},d=function(a,b){return a.updateOrder<b.updateOrder},e=function(){this.states={},this.renderOrder=[],this.updateOrder=[]};e.prototype.add=function(a,b){return this.states[a]=this._newStateHolder(a,b),this.refreshOrder(),b},e.prototype.enable=function(a){var b=this.get(a);b&&(b.enabled||(b.state.enable&&b.state.enable(),b.enabled=!0,b.paused&&this.unpause(a)))},e.prototype.disable=function(a){var b=this.get(a);b&&b.enabled&&(b.state.disable&&b.state.disable(),b.enabled=!1)},e.prototype.pause=function(a){var b=this.get(a);b&&(b.state.pause&&b.state.pause(),b.paused=!0)},e.prototype.unpause=function(a){var b=this.get(a);b&&(b.state.unpause&&b.state.unpause(),b.paused=!1)},e.prototype.protect=function(a){var b=this.get(a);b&&(b.protect=!0)},e.prototype.unprotect=function(a){var b=this.get(a);b&&(b.protect=!1)},e.prototype.refreshOrder=function(){this.renderOrder.length=0,this.updateOrder.length=0;for(var a in this.states){var b=this.states[a];b&&(this.renderOrder.push(b),this.updateOrder.push(b))}this.renderOrder.sort(c),this.updateOrder.sort(d)},e.prototype._newStateHolder=function(a,b){var c={};return c.name=a,c.state=b,c.protect=!1,c.enabled=!0,c.paused=!1,c.render=!0,c.initialized=!1,c.updated=!1,c.updateOrder=0,c.renderOrder=0,c},e.prototype.setUpdateOrder=function(a,b){var c=this.get(a);c&&(c.updateOrder=b,this.refreshOrder())},e.prototype.setRenderOrder=function(a,b){var c=this.get(a);c&&(c.renderOrder=b,this.refreshOrder())},e.prototype.destroy=function(a){var b=this.get(a);b&&!b.protect&&(b.state.close&&b.state.close(),delete this.states[a],this.refreshOrder())},e.prototype.destroyAll=function(){for(var a=0,b=this.updateOrder.length;b>a;a++){var c=this.updateOrder[a];c.protect||(c.state.close&&c.state.close(),delete this.states[c.name])}this.refreshOrder()},e.prototype.get=function(a){return this.states[a]},e.prototype.update=function(a){for(var b=0,c=this.updateOrder.length;c>b;b++){var d=this.updateOrder[b];d&&d.enabled&&d.state.update&&!d.paused&&(!d.initialized&&d.state.init&&(d.initialized=!0,d.state.init()),d.state.update(a),d.updated=!0)}},e.prototype.exitUpdate=function(a){for(var b=0,c=this.updateOrder.length;c>b;b++){var d=this.updateOrder[b];d.enabled&&d.state.exitUpdate&&!d.paused&&d.state.exitUpdate(a)}},e.prototype.render=function(){for(var a=0,b=this.renderOrder.length;b>a;a++){var c=this.renderOrder[a];c.enabled&&(c.updated||!c.state.update)&&c.render&&c.state.render&&c.state.render()}},e.prototype.mousemove=function(a,b,c){for(var d=0,e=this.updateOrder.length;e>d;d++){var f=this.updateOrder[d];f.enabled&&f.state.mousemove&&!f.paused&&f.state.mousemove(a,b,c)}},e.prototype.mouseup=function(a,b,c){for(var d=0,e=this.updateOrder.length;e>d;d++){var f=this.updateOrder[d];f.enabled&&f.state.mouseup&&!f.paused&&f.state.mouseup(a,b,c)}},e.prototype.mousedown=function(a,b,c){for(var d=0,e=this.updateOrder.length;e>d;d++){var f=this.updateOrder[d];f.enabled&&f.state.mousedown&&!f.paused&&f.state.mousedown(a,b,c)}},e.prototype.click=function(a,b,c){for(var d=0,e=this.updateOrder.length;e>d;d++){var f=this.updateOrder[d];f.enabled&&f.state.click&&!f.paused&&f.state.click(a,b,c)}},e.prototype.keypress=function(a){for(var b=0,c=this.updateOrder.length;c>b;b++){var d=this.updateOrder[b];d.enabled&&d.state.keypress&&!d.paused&&d.state.keypress(a)}},e.prototype.keyup=function(a){for(var b=0,c=this.updateOrder.length;c>b;b++){var d=this.updateOrder[b];d.enabled&&d.state.keyup&&!d.paused&&d.state.keyup(a)}},e.prototype.keydown=function(a){for(var b=0,c=this.updateOrder.length;c>b;b++){var d=this.updateOrder[b];d.enabled&&d.state.keydown&&!d.paused&&d.state.keydown(a)}},e.prototype.resize=function(){for(var a=0,b=this.updateOrder.length;b>a;a++){var c=this.updateOrder[a];c.enabled&&c.render&&c.state.resize&&c.state.resize()}},b.exports=e},{}],20:[function(a,b){b.exports=function(){return window.performance||Date}()},{}],21:[function(a,b,c){{var d=c.get=function(a,b){var c=new XMLHttpRequest;c.open("GET",a,!0),c.onload=function(){b(this.response)},c.send()};c.getJSON=function(a,b){d(a,function(a){b(JSON.parse(a))})}}c.isFunction=function(a){return!!(a&&a.constructor&&a.call&&a.apply)}},{}],22:[function(a,b){var c=a("./retina")(),d=function(a,b,c){this.game=a,this.config=c,this.canvas=b,this.width=a.width,this.height=a.height,c.initializeCanvas&&(this.ctx=b.getContext("2d")),this._applySizeToCanvas()};d.prototype.include=function(a){for(var b in a)this[b]=a[b]},d.prototype.beginFrame=function(){},d.prototype.endFrame=function(){},d.prototype.scaleCanvas=function(a){this.canvas.style.width=this.canvas.width+"px",this.canvas.style.height=this.canvas.height+"px",this.canvas.width*=a,this.canvas.height*=a,this.ctx&&this.ctx.scale(a,a)},d.prototype.setSize=function(a,b){this.width=a,this.height=b,this._applySizeToCanvas()},d.prototype._applySizeToCanvas=function(){this.canvas.width=this.width,this.canvas.height=this.height;var a=this.canvas.parentElement;a.style.width=this.width+"px",
a.style.height=this.height+"px",this.config.useRetina&&c&&this.scaleCanvas(2)},d.prototype.clear=function(){this.ctx&&this.ctx.clearRect(0,0,this.width,this.height)},d.prototype.createLayer=function(a){a=a||{};var b=this.canvas.parentElement,c=document.createElement("canvas");c.width=this.width,c.height=this.height,c.style.position="absolute",c.style.top="0px",c.style.left="0px",b.appendChild(c);var e=new d(this.game,c,a);return e},b.exports=d},{"./retina":18}]},{},[1]);