!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):"object"==typeof exports?exports.Potion=e():t.Potion=e()}(this,function(){return function(t){function e(n){if(i[n])return i[n].exports;var s=i[n]={exports:{},id:n,loaded:!1};return t[n].call(s.exports,s,s.exports,e),s.loaded=!0,s.exports}var i={};return e.m=t,e.c=i,e.p="",e(0)}([function(t,e,i){"use strict";var n=i(1);t.exports={init:function(t,e){var i=new n(t,e);return i.game}}},function(t,e,i){"use strict";i(2)();var n=i(3),s=i(4),o=i(6),r=i(5),a=function(t,e){var i=this._subclassGame(t,e);t.style.position="relative";var n=document.createElement("canvas");n.style.display="block",t.appendChild(n),this.game=new i(n),this.game.debug=new o(this.game),this._setDefaultStates(),this.tickFunc=function(t){return function(){t.tick()}}(this),this.preloaderTickFunc=function(t){return function(){t._preloaderTick()}}(this),this.strayTime=0,this._time=s.now(),this.game.assets.onload(function(){this.start(),window.cancelAnimationFrame(this.preloaderId),window.requestAnimationFrame(this.tickFunc)}.bind(this)),this.game.assets.isLoading&&(this.preloaderId=window.requestAnimationFrame(this.preloaderTickFunc))};a.prototype.addEvents=function(){var t=this;t.game,window.addEventListener("blur",function(){t.game.input.resetKeys(),t.game.blur()}),window.addEventListener("focus",function(){t.game.input.resetKeys(),t.game.focus()})},a.prototype.start=function(){this.game.config.addInputEvents&&this.addEvents()},a.prototype.tick=function(){window.requestAnimationFrame(this.tickFunc);var t=s.now(),e=(t-this._time)/1e3;this._time=t,this.game.debug.perf("update"),this.update(e),this.game.debug.stopPerf("update"),this.game.states.exitUpdate(e),this.game.debug.perf("render"),this.render(),this.game.debug.stopPerf("render"),this.game.debug.render()},a.prototype.update=function(t){if(t>this.game.config.maxStepTime&&(t=this.game.config.maxStepTime),this.game.config.fixedStep)for(this.strayTime=this.strayTime+t;this.strayTime>=this.game.config.stepTime;)this.strayTime=this.strayTime-this.game.config.stepTime,this.game.states.update(this.game.config.stepTime);else this.game.states.update(t)},a.prototype.render=function(){this.game.video.beginFrame(),this.game.video.clear(),this.game.states.render(),this.game.video.endFrame()},a.prototype._preloaderTick=function(){this.preloaderId=window.requestAnimationFrame(this.preloaderTickFunc);var t=s.now(),e=(t-this._time)/1e3;this._time=t,this.game.config.showPreloader&&(this.game.video.clear(),this.game.preloading(e))},a.prototype._setDefaultStates=function(){var t=new r;t.add("app",this.game),t.add("debug",this.game.debug),t.protect("app"),t.protect("debug"),t.hide("debug"),this.game.states=t},a.prototype._subclassGame=function(t,e){var i=function(t){n.call(this,t)};i.prototype=Object.create(n.prototype);for(var s in e)i.prototype[s]=e[s];return i},t.exports=a},function(t,e,i){"use strict";t.exports=function(){for(var t=0,e=["ms","moz","webkit","o"],i=0;i<e.length&&!window.requestAnimationFrame;++i)window.requestAnimationFrame=window[e[i]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[e[i]+"CancelAnimationFrame"]||window[e[i]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(e){var i=(new Date).getTime(),n=Math.max(0,16-(i-t)),s=window.setTimeout(function(){e(i+n)},n);return t=i+n,s}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)})}},function(t,e,i){"use strict";var n=i(7),s=i(8),o=i(9),r=function(t){this.canvas=t,this.width=300,this.height=300,this.assets=new s,this.states=null,this.debug=null,this.input=null,this.video=null,this.config={useRetina:!0,initializeCanvas:!0,initializeVideo:!0,addInputEvents:!0,showPreloader:!0,fixedStep:!1,stepTime:.01666,maxStepTime:.01666},this.configure(),this.config.initializeVideo&&(this.video=new n(this,t,this.config)),this.config.addInputEvents&&(this.input=new o(this,t.parentElement))};r.prototype.setSize=function(t,e){this.width=t,this.height=e,this.video&&this.video.setSize(t,e)},r.prototype.preloading=function(t){if((this.config.showPreloader||this.video&&this.video.ctx)&&this.video.ctx){var e="#b9ff71",i="#8ac250",n="#648e38";void 0===this._preloaderWidth&&(this._preloaderWidth=0);var s=Math.min(2*this.width/3,300),o=20,r=(this.height-o)/2,a=(this.width-s)/2,h=s*this.assets.progress;this._preloaderWidth=this._preloaderWidth+(h-this._preloaderWidth)*t*10,this.video.ctx.save(),this.video.ctx.fillStyle=i,this.video.ctx.fillRect(0,0,this.width,this.height),this.video.ctx.font="400 40px sans-serif",this.video.ctx.textAlign="center",this.video.ctx.textBaseline="bottom",this.video.ctx.fillStyle="rgba(0, 0, 0, 0.1)",this.video.ctx.fillText("Potion.js",this.width/2,r+2),this.video.ctx.fillStyle="#d1ffa1",this.video.ctx.fillText("Potion.js",this.width/2,r),this.video.ctx.strokeStyle=this.video.ctx.fillStyle=n,this.video.ctx.fillRect(a,r+15,s,o),this.video.ctx.lineWidth=2,this.video.ctx.beginPath(),this.video.ctx.rect(a-5,r+10,s+10,o+10),this.video.ctx.closePath(),this.video.ctx.stroke(),this.video.ctx.strokeStyle=this.video.ctx.fillStyle="rgba(0, 0, 0, 0.1)",this.video.ctx.fillRect(a,r+15,this._preloaderWidth,o+2),this.video.ctx.lineWidth=2,this.video.ctx.beginPath(),this.video.ctx.moveTo(a+this._preloaderWidth,r+12),this.video.ctx.lineTo(a-5,r+12),this.video.ctx.lineTo(a-5,r+10+o+12),this.video.ctx.lineTo(a+this._preloaderWidth,r+10+o+12),this.video.ctx.stroke(),this.video.ctx.closePath(),this.video.ctx.strokeStyle=this.video.ctx.fillStyle=e,this.video.ctx.fillRect(a,r+15,this._preloaderWidth,o),this.video.ctx.lineWidth=2,this.video.ctx.beginPath(),this.video.ctx.moveTo(a+this._preloaderWidth,r+10),this.video.ctx.lineTo(a-5,r+10),this.video.ctx.lineTo(a-5,r+10+o+10),this.video.ctx.lineTo(a+this._preloaderWidth,r+10+o+10),this.video.ctx.stroke(),this.video.ctx.closePath(),this.video.ctx.restore()}},r.prototype.configure=function(){},r.prototype.focus=function(){},r.prototype.blur=function(){},t.exports=r},function(t,e,i){"use strict";t.exports=function(){return window.performance||Date}()},function(t,e,i){"use strict";var n=function(t,e){return t.renderOrder<e.renderOrder},s=function(t,e){return t.updateOrder<e.updateOrder},o=function(){this.states={},this.renderOrder=[],this.updateOrder=[],this._preventEvent=!1};o.prototype.add=function(t,e){return this.states[t]=this._newStateHolder(t,e),this.refreshOrder(),e},o.prototype.enable=function(t){var e=this.get(t);e&&(e.enabled||(e.state.enable&&e.state.enable(),e.enabled=!0,e.changed=!0,e.paused&&this.unpause(t)))},o.prototype.disable=function(t){var e=this.get(t);e&&e.enabled&&(e.state.disable&&e.state.disable(),e.changed=!0,e.enabled=!1)},o.prototype.hide=function(t){var e=this.get(t);e&&e.enabled&&(e.changed=!0,e.render=!1)},o.prototype.show=function(t){var e=this.get(t);e&&e.enabled&&(e.changed=!0,e.render=!0)},o.prototype.pause=function(t){var e=this.get(t);e&&(e.state.pause&&e.state.pause(),e.changed=!0,e.paused=!0)},o.prototype.unpause=function(t){var e=this.get(t);e&&(e.state.unpause&&e.state.unpause(),e.changed=!0,e.paused=!1)},o.prototype.protect=function(t){var e=this.get(t);e&&(e.protect=!0)},o.prototype.unprotect=function(t){var e=this.get(t);e&&(e.protect=!1)},o.prototype.refreshOrder=function(){this.renderOrder.length=0,this.updateOrder.length=0;for(var t in this.states){var e=this.states[t];e&&(this.renderOrder.push(e),this.updateOrder.push(e))}this.renderOrder.sort(n),this.updateOrder.sort(s)},o.prototype._newStateHolder=function(t,e){var i={};return i.name=t,i.state=e,i.protect=!1,i.enabled=!0,i.paused=!1,i.render=!0,i.initialized=!1,i.updated=!1,i.changed=!0,i.updateOrder=0,i.renderOrder=0,i},o.prototype.setUpdateOrder=function(t,e){var i=this.get(t);i&&(i.updateOrder=e,this.refreshOrder())},o.prototype.setRenderOrder=function(t,e){var i=this.get(t);i&&(i.renderOrder=e,this.refreshOrder())},o.prototype.destroy=function(t){var e=this.get(t);e&&!e.protect&&(e.state.close&&e.state.close(),delete this.states[t],this.refreshOrder())},o.prototype.destroyAll=function(){for(var t=0,e=this.updateOrder.length;e>t;t++){var i=this.updateOrder[t];i.protect||(i.state.close&&i.state.close(),delete this.states[i.name])}this.refreshOrder()},o.prototype.get=function(t){return this.states[t]},o.prototype.update=function(t){for(var e=0,i=this.updateOrder.length;i>e;e++){var n=this.updateOrder[e];n&&(n.changed=!1,n.enabled&&(!n.initialized&&n.state.init&&(n.initialized=!0,n.state.init()),n.state.update&&!n.paused&&(n.state.update(t),n.updated=!0)))}},o.prototype.exitUpdate=function(t){for(var e=0,i=this.updateOrder.length;i>e;e++){var n=this.updateOrder[e];n.enabled&&n.state.exitUpdate&&!n.paused&&n.state.exitUpdate(t)}},o.prototype.render=function(){for(var t=0,e=this.renderOrder.length;e>t;t++){var i=this.renderOrder[t];i.enabled&&(i.updated||!i.state.update)&&i.render&&i.state.render&&i.state.render()}},o.prototype.mousemove=function(t){this._preventEvent=!1;for(var e=0,i=this.updateOrder.length;i>e;e++){var n=this.updateOrder[e];if(n.enabled&&!n.changed&&n.state.mousemove&&!n.paused&&n.state.mousemove(t),this._preventEvent)break}},o.prototype.mouseup=function(t){this._preventEvent=!1;for(var e=0,i=this.updateOrder.length;i>e;e++){var n=this.updateOrder[e];if(n.enabled&&!n.changed&&n.state.mouseup&&!n.paused&&n.state.mouseup(t),this._preventEvent)break}},o.prototype.mousedown=function(t){this._preventEvent=!1;for(var e=0,i=this.updateOrder.length;i>e;e++){var n=this.updateOrder[e];if(n.enabled&&!n.changed&&n.state.mousedown&&!n.paused&&n.state.mousedown(t),this._preventEvent)break}},o.prototype.keyup=function(t){this._preventEvent=!1;for(var e=0,i=this.updateOrder.length;i>e;e++){var n=this.updateOrder[e];if(n.enabled&&!n.changed&&n.state.keyup&&!n.paused&&n.state.keyup(t),this._preventEvent)break}},o.prototype.keydown=function(t){this._preventEvent=!1;for(var e=0,i=this.updateOrder.length;i>e;e++){var n=this.updateOrder[e];if(n.enabled&&!n.changed&&n.state.keydown&&!n.paused&&n.state.keydown(t),this._preventEvent)break}},t.exports=o},function(t,e,i){"use strict";var n=i(11),s=i(10),o=[],r=function(){var t=o.pop();return t?t:{}},a=function(t){return 9>=t?48+t:10===t?48:t>10&&36>=t?64+(t-10):null},h=[{name:"Show FPS",entry:"showFps",defaults:!0},{name:"Show Key Codes",entry:"showKeyCodes",defaults:!0}],u=function(t){this.video=t.video.createLayer({useRetina:!0,initializeCanvas:!0}),this.graph=t.video.createLayer({useRetina:!1,initializeCanvas:!0}),this.app=t,this.options=h,this._maxLogsCounts=10;for(var e=0;e<this.options.length;e++){var i=this.options[e];this._initOption(i)}this.disabled=!1,this.fps=0,this.fpsCount=0,this.fpsElapsedTime=0,this.fpsUpdateInterval=.5,this._framePerf=[],this._fontSize=0,this._dirtyManager=new s(this.video.canvas,this.video.ctx),this.logs=[],this._perfValues={},this._perfNames=[],this.showDebug=!1,this.enableDebugKeys=!0,this.enableShortcuts=!1,this.enableShortcutsKey=220,this.lastKey=null,this._load(),this.keyShortcuts=[{key:123,entry:"showDebug",type:"toggle"}];var n=this;this.addConfig({name:"Show Performance Graph",entry:"showGraph",defaults:!1,call:function(){n.graph.clear()}})};u.prototype._setFont=function(t,e){this._fontSize=t,this.video.ctx.font=t+"px "+e},u.prototype.resize=function(){this.video.setSize(this.app.width,this.app.height)},u.prototype.addConfig=function(t){this.options.push(t),this._initOption(t)},u.prototype._initOption=function(t){t.type=t.type||"toggle",t.defaults=null==t.defaults?!1:t.defaults,"toggle"===t.type&&(this[t.entry]=t.defaults)},u.prototype.clear=function(){this.logs.length=0},u.prototype.log=function(t,e){e=e||"white",t="string"==typeof t?t:n.inspect(t);for(var i=t.replace(/\\'/g,"'").split("\n"),s=0;s<i.length;s++){var a=i[s];this.logs.length>=this._maxLogsCounts&&o.push(this.logs.shift());var h=r();h.text=a,h.life=10,h.color=e,this.logs.push(h)}},u.prototype.update=function(){},u.prototype.exitUpdate=function(t){if(!this.disabled&&this.showDebug){if(this._maxLogsCounts=Math.ceil((this.app.height+20)/20),this.fpsCount+=1,this.fpsElapsedTime+=t,this.fpsElapsedTime>this.fpsUpdateInterval){var e=this.fpsCount/this.fpsElapsedTime;this.showFps&&(this.fps=this.fps*(1-.8)+.8*e),this.fpsCount=0,this.fpsElapsedTime=0}for(var i=0,n=this.logs.length;n>i;i++){var s=this.logs[i];if(s&&(s.life-=t,s.life<=0)){var o=this.logs.indexOf(s);o>-1&&this.logs.splice(o,1)}}}},u.prototype.keydown=function(t){if(!this.disabled){this.lastKey=t.key;var e;if(this.enableDebugKeys){if(t.key===this.enableShortcutsKey)return t.event.preventDefault(),this.enableShortcuts=!this.enableShortcuts,!0;if(this.enableShortcuts)for(e=0;e<this.options.length;e++){var i=this.options[e],n=e+1;this.app.input.isKeyDown("ctrl")&&(n-=36);var s=a(n);if(s&&t.key===s)return t.event.preventDefault(),"toggle"===i.type?(this[i.entry]=!this[i.entry],i.call&&i.call(),this._save()):"call"===i.type&&i.entry(),!0}}for(e=0;e<this.keyShortcuts.length;e++){var o=this.keyShortcuts[e];if(o.key===t.key)return t.event.preventDefault(),"toggle"===o.type?(this[o.entry]=!this[o.entry],this._save()):"call"===o.type&&this[o.entry](),!0}return!1}},u.prototype._save=function(){for(var t={showDebug:this.showDebug,options:{}},e=0;e<this.options.length;e++){var i=this.options[e],n=this[i.entry];t.options[i.entry]=n}window.localStorage.__potionDebug=JSON.stringify(t)},u.prototype._load=function(){if(window.localStorage&&window.localStorage.__potionDebug){var t=JSON.parse(window.localStorage.__potionDebug);this.showDebug=t.showDebug;for(var e in t.options)this[e]=t.options[e]}},u.prototype.render=function(){if(!this.disabled&&(this._dirtyManager.clear(),this.showDebug&&(this.video.ctx.save(),this._setFont(15,"sans-serif"),this._renderLogs(),this._renderData(),this._renderShortcuts(),this.video.ctx.restore(),this.showGraph))){this.graph.ctx.drawImage(this.graph.canvas,0,this.app.height-100,this.app.width,100,-2,this.app.height-100,this.app.width,100),this.graph.ctx.fillStyle="#F2F0D8",this.graph.ctx.fillRect(this.app.width-2,this.app.height-100,2,100);for(var t=0,e=0;e<this._framePerf.length;e++){var i=this._framePerf[e],n=this._perfNames[e],s="black";"update"===n?s="#6BA5F2":"render"===n&&(s="#F27830"),this.graph.ctx.fillStyle=s;var o=100*(i+t)/16;o>100&&(o=100),this.graph.ctx.fillRect(this.app.width-2,this.app.height-o,2,o-100*t/16),t+=i}this._framePerf.length=0}},u.prototype._renderLogs=function(){this.video.ctx.textAlign="left",this.video.ctx.textBaseline="bottom";for(var t=0,e=this.logs.length;e>t;t++){var i=this.logs[t],n=-10+this.app.height+20*(t-this.logs.length+1);this._renderText(i.text,10,n,i.color)}},u.prototype.disable=function(){this.disabled=!0},u.prototype.perf=function(t){if(this.showDebug){var e=this._perfValues[t];null==e&&(this._perfNames.push(t),this._perfValues[t]={name:t,value:0,records:[]});var i=window.performance.now(),n=this._perfValues[t];n.value=i}},u.prototype.stopPerf=function(t){if(this.showDebug){var e=this._perfValues[t],i=window.performance.now(),n=i-e.value;e.records.push(n),e.records.length>10&&e.records.shift();for(var s=0,o=0;o<e.records.length;o++)s+=e.records[o];var r=s/e.records.length;e.value=r,this._framePerf.push(n)}},u.prototype._renderData=function(){this.video.ctx.textAlign="right",this.video.ctx.textBaseline="top";var t=this.app.width-14,e=14;if(this.showFps&&this._renderText(Math.round(this.fps)+" fps",t,e),e+=24,this._setFont(15,"sans-serif"),this.showKeyCodes){var i="";this.app.input.mouse.isLeftDown?i="left":this.app.input.mouse.isRightDown?i="right":this.app.input.mouse.isMiddleDown&&(i="middle"),this._renderText("key "+this.lastKey,t,e,this.app.input.isKeyDown(this.lastKey)?"#e9dc7c":"white"),this._renderText("btn "+i,t-60,e,this.app.input.mouse.isDown?"#e9dc7c":"white");for(var n=0;n<this._perfNames.length;n++){var s=this._perfNames[n],o=this._perfValues[s];e+=24,this._renderText(s+": "+o.value.toFixed(3)+"ms",t,e)}}},u.prototype._renderShortcuts=function(){if(this.enableShortcuts){var t=28;this._setFont(20,"Helvetica Neue, sans-serif"),this.video.ctx.textAlign="left",this.video.ctx.textBaseline="top";for(var e=Math.floor((this.app.height-14)/t),i=0;i<this.options.length;i++){var n=this.options[i],s=14+320*Math.floor(i/e),o=14+i%e*t,r=i+1,h=a(r),u=this[n.entry],c=String.fromCharCode(h);h||(c="^+"+String.fromCharCode(a(r-36)));var p="["+c+"] "+n.name;"toggle"===n.type?p+=" ("+(u?"ON":"OFF")+")":"call"===n.type&&(p+=" (CALL)");var d="rgba(255, 255, 255, 1)",l="rgba(0, 0, 0, 1)";u||(d="rgba(255, 255, 255, .7)",l="rgba(0, 0, 0, .7)"),this._renderText(p,s,o,d,l)}}},u.prototype._renderText=function(t,e,i,n,s){n=n||"white",s=s||"black",this.video.ctx.fillStyle=n,this.video.ctx.lineJoin="round",this.video.ctx.strokeStyle=s,this.video.ctx.lineWidth=3,this.video.ctx.strokeText(t,e,i),this.video.ctx.fillText(t,e,i);var o=this.video.ctx.measureText(t).width,r=e-5,a=i,h=o+10,u=this._fontSize+10;"right"===this.video.ctx.textAlign&&(r=e-5-o),this._dirtyManager.addRect(r,a,h,u)},t.exports=u},function(t,e,i){"use strict";var n=i(12)(),s=function(t,e,i){this.game=t,this.config=i,this.canvas=e,this.width=t.width,this.height=t.height,i.initializeCanvas&&(this.ctx=e.getContext("2d")),this._applySizeToCanvas()};s.prototype.include=function(t){for(var e in t)this[e]=t[e]},s.prototype.beginFrame=function(){},s.prototype.endFrame=function(){},s.prototype.scaleCanvas=function(t){this.canvas.style.width=this.canvas.width+"px",this.canvas.style.height=this.canvas.height+"px",this.canvas.width*=t,this.canvas.height*=t,this.ctx&&this.ctx.scale(t,t)},s.prototype.setSize=function(t,e){this.width=t,this.height=e,this._applySizeToCanvas()},s.prototype._applySizeToCanvas=function(){this.canvas.width=this.width,this.canvas.height=this.height;var t=this.canvas.parentElement;t.style.width=this.width+"px",t.style.height=this.height+"px",this.config.useRetina&&n&&this.scaleCanvas(2)},s.prototype.clear=function(){this.ctx&&this.ctx.clearRect(0,0,this.width,this.height)},s.prototype.createLayer=function(t){t=t||{};var e=this.canvas.parentElement,i=document.createElement("canvas");i.width=this.width,i.height=this.height,i.style.position="absolute",i.style.top="0px",i.style.left="0px",e.appendChild(i);var n=new s(this.game,i,t);return n},t.exports=s},function(t,e,i){(function(e){"use strict";var n=i(13),s=i(15),o=i(16),r=function(){this.isLoading=!1,this.itemsCount=0,this.loadedItemsCount=0,this.progress=0,this._xhr=new XMLHttpRequest,this._thingsToLoad=0,this._data={},this._preloading=!0,this.callback=null,this._toLoad=[],this.audio=new o};r.prototype.onload=function(t){this.callback=t,0===this._thingsToLoad?(this.isLoading=!1,this._preloading=!1,e.nextTick(function(){t()})):this._nextFile()},r.prototype.get=function(t){return this._data[s.normalize(t)]},r.prototype.remove=function(t){this.set(t,null)},r.prototype.set=function(t,e){this._data[s.normalize(t)]=e},r.prototype.load=function(t,e,i){var n={type:t,url:null!=e?s.normalize(e):null,callback:i};if(this._preloading)this.isLoading=!0,this.itemsCount+=1,this._thingsToLoad+=1,this._toLoad.push(n);else{var o=this;this._loadAssetFile(n,function(t){o.set(n.url,t),i&&i(t)})}},r.prototype._finishedOneFile=function(){if(this._nextFile(),this.progress=this.loadedItemsCount/this.itemsCount,this._thingsToLoad-=1,this.loadedItemsCount+=1,0===this._thingsToLoad){var t=this;setTimeout(function(){t.callback(),t._preloading=!1,t.isLoading=!1},0)}},r.prototype._error=function(t,e){console.warn('Error loading "'+t+'" asset with url '+e),this._nextFile()},r.prototype._save=function(t,e,i){this.set(t,e),i&&i(e),this._finishedOneFile()},r.prototype._handleCustomLoading=function(t){var e=this,i=function(t,i){e._save(t,i)};t(i)},r.prototype._nextFile=function(){var t=this._toLoad.shift();if(t){var e=this;this._loadAssetFile(t,function(i){e._save(t.url,i,t.callback)})}},r.prototype._loadAssetFile=function(t,e){var i=t.type,s=t.url,o=this;if(n.isFunction(i))return void this._handleCustomLoading(i);i=i.toLowerCase();var r=this._xhr;switch(i){case"json":r.open("GET",s,!0),r.responseType="text",r.onload=function(){var t=JSON.parse(this.response);e(t)},r.onerror=function(){o._error(i,s)},r.send();break;case"mp3":case"music":case"sound":o.audio.load(s,function(t){e(t)});break;case"image":case"texture":case"sprite":var a=new Image;a.onload=function(){e(a)},a.onerror=function(){o._error(i,s)},a.src=s;break;default:r.open("GET",s,!0),r.responseType="text",r.onload=function(){var t=this.response;e(t)},r.onerror=function(){o._error(i,s)},r.send()}},t.exports=r}).call(e,i(17))},function(t,e,i){"use strict";var n=i(14),s={};for(var o in n)s[n[o]]=o;var r=function(t,e){this._container=e,this._keys={},this.canControlKeys=!0,this.mouse={isDown:!1,isLeftDown:!1,isMiddleDown:!1,isRightDown:!1,x:null,y:null},this._addEvents(t)};r.prototype.resetKeys=function(){this._keys={}},r.prototype.isKeyDown=function(t){if(null==t)return!1;if(this.canControlKeys){var e="number"==typeof t?t:n[t.toLowerCase()];return this._keys[e]}},r.prototype._addEvents=function(t){var e=this,i={x:null,y:null,button:null,event:null,statePreventDefault:function(){t.states._preventEvent=!0}},n={key:null,name:null,event:null,statePreventDefault:function(){t.states._preventEvent=!0}};e._container.addEventListener("mousemove",function(n){var s=void 0===n.offsetX?n.layerX-e._container.offsetLeft:n.offsetX,o=void 0===n.offsetY?n.layerY-e._container.offsetTop:n.offsetY;e.mouse.x=s,e.mouse.y=o,i.x=s,i.y=o,i.button=null,i.event=n,t.states.mousemove(i)}),e._container.addEventListener("mouseup",function(n){n.preventDefault();var s=void 0===n.offsetX?n.layerX-e._container.offsetLeft:n.offsetX,o=void 0===n.offsetY?n.layerY-e._container.offsetTop:n.offsetY;switch(e.mouse.isDown=!1,n.button){case 0:e.mouse.isLeftDown=!1;break;case 1:e.mouse.isMiddleDown=!1;break;case 2:e.mouse.isRightDown=!1}i.x=s,i.y=o,i.button=n.button,i.event=n,t.states.mouseup(i)},!1),e._container.addEventListener("mousedown",function(n){n.preventDefault();var s=void 0===n.offsetX?n.layerX-e._container.offsetLeft:n.offsetX,o=void 0===n.offsetY?n.layerY-e._container.offsetTop:n.offsetY;switch(e.mouse.x=s,e.mouse.y=o,e.mouse.isDown=!0,n.button){case 0:e.mouse.isLeftDown=!0;break;case 1:e.mouse.isMiddleDown=!0;break;case 2:e.mouse.isRightDown=!0}i.x=s,i.y=o,i.button=n.button,i.event=n,t.states.mousedown(i)},!1),e._container.addEventListener("touchstart",function(n){n.preventDefault();for(var s=0;s<n.touches.length;s++){var o=n.touches[s],r=o.pageX-e._container.offsetLeft,a=o.pageY-e._container.offsetTop;e.mouse.x=r,e.mouse.y=a,e.mouse.isDown=!0,e.mouse.isLeftDown=!0,i.x=r,i.y=a,i.button=1,i.event=n,t.states.mousedown(n)}}),e._container.addEventListener("touchmove",function(n){n.preventDefault();for(var s=0;s<n.touches.length;s++){var o=n.touches[s],r=o.pageX-e._container.offsetLeft,a=o.pageY-e._container.offsetTop;e.mouse.x=r,e.mouse.y=a,e.mouse.isDown=!0,e.mouse.isLeftDown=!0,i.x=r,i.y=a,i.event=n,t.states.mousemove(n)}}),e._container.addEventListener("touchend",function(n){n.preventDefault();var s=n.changedTouches[0],o=s.pageX-e._container.offsetLeft,r=s.pageY-e._container.offsetTop;e.mouse.x=o,e.mouse.y=r,e.mouse.isDown=!1,e.mouse.isLeftDown=!1,i.x=o,i.y=r,i.event=n,t.states.mouseup(n)}),e._container.addEventListener("contextmenu",function(t){t.preventDefault()}),document.addEventListener("keydown",function(i){e._keys[i.keyCode]=!0,n.key=i.which,n.name=s[i.which],n.event=i,t.states.keydown(n)}),document.addEventListener("keyup",function(i){e._keys[i.keyCode]=!1,n.key=i.which,n.name=s[i.which],n.event=i,t.states.keyup(n)})},t.exports=r},function(t,e,i){"use strict";var n=function(t,e){this.ctx=e,this.canvas=t,this.top=t.height,this.left=t.width,this.bottom=0,this.right=0,this.isDirty=!1};n.prototype.addRect=function(t,e,i,n){var s=t+i,o=e+n;this.top=e<this.top?e:this.top,this.left=t<this.left?t:this.left,this.bottom=o>this.bottom?o:this.bottom,this.right=s>this.right?s:this.right,this.isDirty=!0},n.prototype.clear=function(){this.isDirty&&(this.ctx.clearRect(this.left,this.top,this.right-this.left,this.bottom-this.top),this.left=this.canvas.width,this.top=this.canvas.height,this.right=0,this.bottom=0,this.isDirty=!1)},t.exports=n},function(t,e,i){(function(t,n){"use strict";function s(t,i){var n={seen:[],stylize:r};return arguments.length>=3&&(n.depth=arguments[2]),arguments.length>=4&&(n.colors=arguments[3]),v(i)?n.showHidden=i:i&&e._extend(n,i),b(n.showHidden)&&(n.showHidden=!1),b(n.depth)&&(n.depth=2),b(n.colors)&&(n.colors=!1),b(n.customInspect)&&(n.customInspect=!0),n.colors&&(n.stylize=o),h(n,t,n.depth)}function o(t,e){var i=s.styles[e];return i?"["+s.colors[i][0]+"m"+t+"["+s.colors[i][1]+"m":t}function r(t,e){return t}function a(t){var e={};return t.forEach(function(t,i){e[t]=!0}),e}function h(t,i,n){if(t.customInspect&&i&&T(i.inspect)&&i.inspect!==e.inspect&&(!i.constructor||i.constructor.prototype!==i)){var s=i.inspect(n,t);return w(s)||(s=h(t,s,n)),s}var o=u(t,i);if(o)return o;var r=Object.keys(i),v=a(r);if(t.showHidden&&(r=Object.getOwnPropertyNames(i)),k(i)&&(r.indexOf("message")>=0||r.indexOf("description")>=0))return c(i);if(0===r.length){if(T(i)){var g=i.name?": "+i.name:"";return t.stylize("[Function"+g+"]","special")}if(_(i))return t.stylize(RegExp.prototype.toString.call(i),"regexp");if(O(i))return t.stylize(Date.prototype.toString.call(i),"date");if(k(i))return c(i)}var m="",y=!1,x=["{","}"];if(f(i)&&(y=!0,x=["[","]"]),T(i)){var b=i.name?": "+i.name:"";m=" [Function"+b+"]"}if(_(i)&&(m=" "+RegExp.prototype.toString.call(i)),O(i)&&(m=" "+Date.prototype.toUTCString.call(i)),k(i)&&(m=" "+c(i)),0===r.length&&(!y||0==i.length))return x[0]+m+x[1];if(0>n)return _(i)?t.stylize(RegExp.prototype.toString.call(i),"regexp"):t.stylize("[Object]","special");t.seen.push(i);var S;return S=y?p(t,i,n,v,r):r.map(function(e){return d(t,i,n,v,e,y)}),t.seen.pop(),l(S,m,x)}function u(t,e){if(b(e))return t.stylize("undefined","undefined");if(w(e)){var i="'"+JSON.stringify(e).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return t.stylize(i,"string")}return y(e)?t.stylize(""+e,"number"):v(e)?t.stylize(""+e,"boolean"):g(e)?t.stylize("null","null"):void 0}function c(t){return"["+Error.prototype.toString.call(t)+"]"}function p(t,e,i,n,s){for(var o=[],r=0,a=e.length;a>r;++r)o.push(C(e,String(r))?d(t,e,i,n,String(r),!0):"");return s.forEach(function(s){s.match(/^\d+$/)||o.push(d(t,e,i,n,s,!0))}),o}function d(t,e,i,n,s,o){var r,a,u;if(u=Object.getOwnPropertyDescriptor(e,s)||{value:e[s]},u.get?a=u.set?t.stylize("[Getter/Setter]","special"):t.stylize("[Getter]","special"):u.set&&(a=t.stylize("[Setter]","special")),C(n,s)||(r="["+s+"]"),a||(t.seen.indexOf(u.value)<0?(a=g(i)?h(t,u.value,null):h(t,u.value,i-1),a.indexOf("\n")>-1&&(a=o?a.split("\n").map(function(t){return"  "+t}).join("\n").substr(2):"\n"+a.split("\n").map(function(t){return"   "+t}).join("\n"))):a=t.stylize("[Circular]","special")),b(r)){if(o&&s.match(/^\d+$/))return a;r=JSON.stringify(""+s),r.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(r=r.substr(1,r.length-2),r=t.stylize(r,"name")):(r=r.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),r=t.stylize(r,"string"))}return r+": "+a}function l(t,e,i){var n=0,s=t.reduce(function(t,e){return n++,e.indexOf("\n")>=0&&n++,t+e.replace(/\u001b\[\d\d?m/g,"").length+1},0);return s>60?i[0]+(""===e?"":e+"\n ")+" "+t.join(",\n  ")+" "+i[1]:i[0]+e+" "+t.join(", ")+" "+i[1]}function f(t){return Array.isArray(t)}function v(t){return"boolean"==typeof t}function g(t){return null===t}function m(t){return null==t}function y(t){return"number"==typeof t}function w(t){return"string"==typeof t}function x(t){return"symbol"==typeof t}function b(t){return void 0===t}function _(t){return S(t)&&"[object RegExp]"===E(t)}function S(t){return"object"==typeof t&&null!==t}function O(t){return S(t)&&"[object Date]"===E(t)}function k(t){return S(t)&&("[object Error]"===E(t)||t instanceof Error)}function T(t){return"function"==typeof t}function D(t){return null===t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||"symbol"==typeof t||"undefined"==typeof t}function E(t){return Object.prototype.toString.call(t)}function L(t){return 10>t?"0"+t.toString(10):t.toString(10)}function F(){var t=new Date,e=[L(t.getHours()),L(t.getMinutes()),L(t.getSeconds())].join(":");return[t.getDate(),P[t.getMonth()],e].join(" ")}function C(t,e){return Object.prototype.hasOwnProperty.call(t,e)}var A=/%[sdj%]/g;e.format=function(t){if(!w(t)){for(var e=[],i=0;i<arguments.length;i++)e.push(s(arguments[i]));return e.join(" ")}for(var i=1,n=arguments,o=n.length,r=String(t).replace(A,function(t){if("%%"===t)return"%";if(i>=o)return t;switch(t){case"%s":return String(n[i++]);case"%d":return Number(n[i++]);case"%j":try{return JSON.stringify(n[i++])}catch(e){return"[Circular]"}default:return t}}),a=n[i];o>i;a=n[++i])r+=g(a)||!S(a)?" "+a:" "+s(a);return r},e.deprecate=function(i,s){function o(){if(!r){if(n.throwDeprecation)throw new Error(s);n.traceDeprecation?console.trace(s):console.error(s),r=!0}return i.apply(this,arguments)}if(b(t.process))return function(){return e.deprecate(i,s).apply(this,arguments)};if(n.noDeprecation===!0)return i;var r=!1;return o};var z,j={};e.debuglog=function(t){if(b(z)&&(z=n.env.NODE_DEBUG||""),t=t.toUpperCase(),!j[t])if(new RegExp("\\b"+t+"\\b","i").test(z)){var i=n.pid;j[t]=function(){var n=e.format.apply(e,arguments);console.error("%s %d: %s",t,i,n)}}else j[t]=function(){};return j[t]},e.inspect=s,s.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},s.styles={special:"cyan",number:"yellow","boolean":"yellow",undefined:"grey","null":"bold",string:"green",date:"magenta",regexp:"red"},e.isArray=f,e.isBoolean=v,e.isNull=g,e.isNullOrUndefined=m,e.isNumber=y,e.isString=w,e.isSymbol=x,e.isUndefined=b,e.isRegExp=_,e.isObject=S,e.isDate=O,e.isError=k,e.isFunction=T,e.isPrimitive=D,e.isBuffer=i(18);var P=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];e.log=function(){console.log("%s - %s",F(),e.format.apply(e,arguments))},e.inherits=i(20),e._extend=function(t,e){if(!e||!S(e))return t;for(var i=Object.keys(e),n=i.length;n--;)t[i[n]]=e[i[n]];return t}}).call(e,function(){return this}(),i(17))},function(t,e,i){"use strict";var n=function(){var t="(-webkit-min-device-pixel-ratio: 1.5),  (min--moz-device-pixel-ratio: 1.5),  (-o-min-device-pixel-ratio: 3/2),  (min-resolution: 1.5dppx)";return window.devicePixelRatio>1?!0:window.matchMedia&&window.matchMedia(t).matches?!0:!1};t.exports=n},function(t,e,i){"use strict";var n=e.get=function(t,e){var i=new XMLHttpRequest;i.open("GET",t,!0),i.onload=function(){e(this.response)},i.send()};e.getJSON=function(t,e){n(t,function(t){e(JSON.parse(t))})},e.isFunction=function(t){return!!(t&&t.constructor&&t.call&&t.apply)}},function(t,e,i){"use strict";t.exports={backspace:8,tab:9,enter:13,pause:19,caps:20,esc:27,space:32,page_up:33,page_down:34,end:35,home:36,left:37,up:38,right:39,down:40,insert:45,"delete":46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,numpad_0:96,numpad_1:97,numpad_2:98,numpad_3:99,numpad_4:100,numpad_5:101,numpad_6:102,numpad_7:103,numpad_8:104,numpad_9:105,multiply:106,add:107,substract:109,decimal:110,divide:111,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,shift:16,ctrl:17,alt:18,plus:187,comma:188,minus:189,period:190}},function(t,e,i){(function(t){"use strict";function i(t,e){for(var i=0,n=t.length-1;n>=0;n--){var s=t[n];"."===s?t.splice(n,1):".."===s?(t.splice(n,1),i++):i&&(t.splice(n,1),i--)}if(e)for(;i--;i)t.unshift("..");return t}function n(t,e){if(t.filter)return t.filter(e);for(var i=[],n=0;n<t.length;n++)e(t[n],n,t)&&i.push(t[n]);

return i}var s=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,o=function(t){return s.exec(t).slice(1)};e.resolve=function(){for(var e="",s=!1,o=arguments.length-1;o>=-1&&!s;o--){var r=o>=0?arguments[o]:t.cwd();if("string"!=typeof r)throw new TypeError("Arguments to path.resolve must be strings");r&&(e=r+"/"+e,s="/"===r.charAt(0))}return e=i(n(e.split("/"),function(t){return!!t}),!s).join("/"),(s?"/":"")+e||"."},e.normalize=function(t){var s=e.isAbsolute(t),o="/"===r(t,-1);return t=i(n(t.split("/"),function(t){return!!t}),!s).join("/"),t||s||(t="."),t&&o&&(t+="/"),(s?"/":"")+t},e.isAbsolute=function(t){return"/"===t.charAt(0)},e.join=function(){var t=Array.prototype.slice.call(arguments,0);return e.normalize(n(t,function(t,e){if("string"!=typeof t)throw new TypeError("Arguments to path.join must be strings");return t}).join("/"))},e.relative=function(t,i){function n(t){for(var e=0;e<t.length&&""===t[e];e++);for(var i=t.length-1;i>=0&&""===t[i];i--);return e>i?[]:t.slice(e,i-e+1)}t=e.resolve(t).substr(1),i=e.resolve(i).substr(1);for(var s=n(t.split("/")),o=n(i.split("/")),r=Math.min(s.length,o.length),a=r,h=0;r>h;h++)if(s[h]!==o[h]){a=h;break}for(var u=[],h=a;h<s.length;h++)u.push("..");return u=u.concat(o.slice(a)),u.join("/")},e.sep="/",e.delimiter=":",e.dirname=function(t){var e=o(t),i=e[0],n=e[1];return i||n?(n&&(n=n.substr(0,n.length-1)),i+n):"."},e.basename=function(t,e){var i=o(t)[2];return e&&i.substr(-1*e.length)===e&&(i=i.substr(0,i.length-e.length)),i},e.extname=function(t){return o(t)[3]};var r="b"==="ab".substr(-1)?function(t,e,i){return t.substr(e,i)}:function(t,e,i){return 0>e&&(e=t.length+e),t.substr(e,i)}}).call(e,i(17))},function(t,e,i){"use strict";t.exports=i(19)},function(t,e,i){"use strict";function n(){if(!a){a=!0;for(var t,e=r.length;e;){t=r,r=[];for(var i=-1;++i<e;)t[i]();e=r.length}a=!1}}function s(){}var o=t.exports={},r=[],a=!1;o.nextTick=function(t){r.push(t),a||setTimeout(n,0)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=s,o.addListener=s,o.once=s,o.off=s,o.removeListener=s,o.removeAllListeners=s,o.emit=s,o.binding=function(t){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(t){throw new Error("process.chdir is not supported")},o.umask=function(){return 0}},function(t,e,i){"use strict";t.exports=function(t){return t&&"object"==typeof t&&"function"==typeof t.copy&&"function"==typeof t.fill&&"function"==typeof t.readUInt8}},function(t,e,i){"use strict";var n=i(21),s=function(){var t=window.AudioContext||window.webkitAudioContext;this.ctx=new t,this.masterGain=this.ctx.createGain(),this._volume=1;var e=/(iPad|iPhone|iPod)/g.test(navigator.userAgent);e&&this._enableiOS()};s.prototype._enableiOS=function(){var t=this,e=function(t){var e=function(){return t.apply(this,arguments)};return e.toString=function(){return t.toString()},e}(function(){var i=t.ctx.createBuffer(1,1,22050),n=t.ctx.createBufferSource();n.buffer=i,n.connect(t.ctx.destination),n.start(0),window.removeEventListener("touchstart",e,!1)});window.addEventListener("touchstart",e,!1)},s.prototype.setVolume=function(t){this._volume=t,this.masterGain.gain.value=t},s.prototype.load=function(t,e){var i=this,n=new XMLHttpRequest;n.open("GET",t,!0),n.responseType="arraybuffer",n.onload=function(){i.decodeAudioData(n.response,function(t){e(t)})},n.send()},s.prototype.decodeAudioData=function(t,e){var i=this;this.ctx.decodeAudioData(t,function(t){var s=new n(i.ctx,t,i.masterGain);e(s)})},t.exports=s},function(t,e,i){"use strict";t.exports="function"==typeof Object.create?function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:function(t,e){t.super_=e;var i=function(){};i.prototype=e.prototype,t.prototype=new i,t.prototype.constructor=t}},function(t,e,i){"use strict";var n=i(22),s=function(t,e,i){this._ctx=t,this._masterGain=i,this._buffer=e,this._buffer.loop=!1};s.prototype._createSound=function(t){var e=this._ctx.createBufferSource();return e.buffer=this._buffer,this._masterGain.connect(this._ctx.destination),t.connect(this._masterGain),e.connect(t),e},s.prototype.play=function(){var t=this._ctx.createGain(),e=this._createSound(t);return e.start(0),new n(e,t)},s.prototype.fadeIn=function(t,e){var i=this._ctx.createGain(),s=this._createSound(i);return i.gain.setValueAtTime(0,0),i.gain.linearRampToValueAtTime(.01,0),i.gain.linearRampToValueAtTime(t,e),s.start(0),new n(s,i)},s.prototype.loop=function(){var t=this._ctx.createGain(),e=this._createSound(t);return e.loop=!0,e.start(0),new n(e,t)},t.exports=s},function(t,e,i){"use strict";var n=function(t,e){this._gain=e,this._source=t};n.prototype.setVolume=function(t){this._gain.gain.value=t},n.prototype.stop=function(){this._source.stop(0)},t.exports=n}])});